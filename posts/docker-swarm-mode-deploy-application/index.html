<!DOCTYPE html><html lang="ko-KR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Docker swarm mode을 이용하여 웹 애플리케이션 운영하기" /><meta property="og:locale" content="ko_KR" /><meta name="description" content="docker swarm mode 란 컨테이너 오케스트레이션 툴이다. 컨테이너 오케이션 툴 배포, 관리, 확장, 네트워킹을 자동화한다. 컨테이너 오케스트레이션이란? 기본적인 환경 설정 docker-compose yml 파일에 배포할 환경의 명세를 적는다. 배포 명령을 실행하면 yml 파일대로 환경을 조성한다. 주로 관리하는 기능은 아래와 같다. 각 도커 이미지를 서비스화하여 컨테이너를 생성 이때 컨테이너 수도 조절할 수 있다. 컨테이너 별로 참조하는 네트워크를 세팅 컨테이너가 참조하는 secret과 config 생성 클러스터 구축 Swarm을 쓰는 가장 큰 이유는 여러 서버로 클러스터를 구축하여 애플리케이션을 운영할 때 더 편리하게 관리하기 위함이다. 노드는 서버(컴퓨터)를 의미한다. Swarm 클러스터는 관리자 노드와 워커 노드로 구축할 수 있다. ‘기본적인 환경 설정’은 관리자 노드에서 진행하며 관리자 노드는 docker-compose yml에 따라 다른 노드를 제어한다. 서비스 작동 방식 서비스 작동 방식 Swarm에서 이미지를 배포하면 단일 컨테이너(Standalone container)가 아닌 서비스(Service)를 만들어 배포한다. Swarm 명령어가 입력되면 관리자 노드는 서비스를 생성하고 docker-compose yml 명세에 따라 각 할당 가능한 노드 별로 적절히 컨테이너를 생성한다. 이때 노드 별 할당된 컨테이너를 작업(Task)라고 명명한다." /><meta property="og:description" content="docker swarm mode 란 컨테이너 오케스트레이션 툴이다. 컨테이너 오케이션 툴 배포, 관리, 확장, 네트워킹을 자동화한다. 컨테이너 오케스트레이션이란? 기본적인 환경 설정 docker-compose yml 파일에 배포할 환경의 명세를 적는다. 배포 명령을 실행하면 yml 파일대로 환경을 조성한다. 주로 관리하는 기능은 아래와 같다. 각 도커 이미지를 서비스화하여 컨테이너를 생성 이때 컨테이너 수도 조절할 수 있다. 컨테이너 별로 참조하는 네트워크를 세팅 컨테이너가 참조하는 secret과 config 생성 클러스터 구축 Swarm을 쓰는 가장 큰 이유는 여러 서버로 클러스터를 구축하여 애플리케이션을 운영할 때 더 편리하게 관리하기 위함이다. 노드는 서버(컴퓨터)를 의미한다. Swarm 클러스터는 관리자 노드와 워커 노드로 구축할 수 있다. ‘기본적인 환경 설정’은 관리자 노드에서 진행하며 관리자 노드는 docker-compose yml에 따라 다른 노드를 제어한다. 서비스 작동 방식 서비스 작동 방식 Swarm에서 이미지를 배포하면 단일 컨테이너(Standalone container)가 아닌 서비스(Service)를 만들어 배포한다. Swarm 명령어가 입력되면 관리자 노드는 서비스를 생성하고 docker-compose yml 명세에 따라 각 할당 가능한 노드 별로 적절히 컨테이너를 생성한다. 이때 노드 별 할당된 컨테이너를 작업(Task)라고 명명한다." /><link rel="canonical" href="https://a3magic3pocket.github.io/posts/docker-swarm-mode-deploy-application/" /><meta property="og:url" content="https://a3magic3pocket.github.io/posts/docker-swarm-mode-deploy-application/" /><meta property="og:site_name" content="의사줌치" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-02-08T23:56:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Docker swarm mode을 이용하여 웹 애플리케이션 운영하기" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"docker swarm mode 란 컨테이너 오케스트레이션 툴이다. 컨테이너 오케이션 툴 배포, 관리, 확장, 네트워킹을 자동화한다. 컨테이너 오케스트레이션이란? 기본적인 환경 설정 docker-compose yml 파일에 배포할 환경의 명세를 적는다. 배포 명령을 실행하면 yml 파일대로 환경을 조성한다. 주로 관리하는 기능은 아래와 같다. 각 도커 이미지를 서비스화하여 컨테이너를 생성 이때 컨테이너 수도 조절할 수 있다. 컨테이너 별로 참조하는 네트워크를 세팅 컨테이너가 참조하는 secret과 config 생성 클러스터 구축 Swarm을 쓰는 가장 큰 이유는 여러 서버로 클러스터를 구축하여 애플리케이션을 운영할 때 더 편리하게 관리하기 위함이다. 노드는 서버(컴퓨터)를 의미한다. Swarm 클러스터는 관리자 노드와 워커 노드로 구축할 수 있다. ‘기본적인 환경 설정’은 관리자 노드에서 진행하며 관리자 노드는 docker-compose yml에 따라 다른 노드를 제어한다. 서비스 작동 방식 서비스 작동 방식 Swarm에서 이미지를 배포하면 단일 컨테이너(Standalone container)가 아닌 서비스(Service)를 만들어 배포한다. Swarm 명령어가 입력되면 관리자 노드는 서비스를 생성하고 docker-compose yml 명세에 따라 각 할당 가능한 노드 별로 적절히 컨테이너를 생성한다. 이때 노드 별 할당된 컨테이너를 작업(Task)라고 명명한다.","url":"https://a3magic3pocket.github.io/posts/docker-swarm-mode-deploy-application/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://a3magic3pocket.github.io/posts/docker-swarm-mode-deploy-application/"},"headline":"Docker swarm mode을 이용하여 웹 애플리케이션 운영하기","dateModified":"2024-02-19T12:18:35+09:00","datePublished":"2023-02-08T23:56:00+09:00","@context":"https://schema.org"}</script><title>Docker swarm mode을 이용하여 웹 애플리케이션 운영하기 | 의사줌치</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="의사줌치"><meta name="application-name" content="의사줌치"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-5NQ41XXW83"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-5NQ41XXW83'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/sample/avatar-crop.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">의사줌치</a></div><div class="site-subtitle font-italic">부정확한 정보를 <br /> 담고 있을 수 있습니다.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/a3magic3pocket" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['a3magic3pocket','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Docker swarm mode을 이용하여 웹 애플리케이션 운영하기</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Docker swarm mode을 이용하여 웹 애플리케이션 운영하기</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> 의사줌치 </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Feb 8, 2023, 11:56 PM +0900" prep="on" > Feb 8, 2023 <i class="unloaded">2023-02-08T23:56:00+09:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, Feb 19, 2024, 12:18 PM +0900" prefix="Updated " > Feb 19, 2024 <i class="unloaded">2024-02-19T12:18:35+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3906 words">21 min</span></div></div><div class="post-content"><h2 id="docker-swarm-mode-란">docker swarm mode 란</h2><ul><li>컨테이너 오케스트레이션 툴이다.<ul><li>컨테이너 오케이션 툴<ul><li>배포, 관리, 확장, 네트워킹을 자동화한다.<li><a href="https://www.redhat.com/ko/topics/containers/what-is-container-orchestration" target="_blank">컨테이너 오케스트레이션이란?</a></ul></ul><li>기본적인 환경 설정<ul><li>docker-compose yml 파일에 배포할 환경의 명세를 적는다.<li>배포 명령을 실행하면 yml 파일대로 환경을 조성한다.<li>주로 관리하는 기능은 아래와 같다.<ul><li>각 도커 이미지를 서비스화하여 컨테이너를 생성<ul><li>이때 컨테이너 수도 조절할 수 있다.</ul><li>컨테이너 별로 참조하는 네트워크를 세팅<li>컨테이너가 참조하는 secret과 config 생성</ul></ul><li>클러스터 구축<ul><li>Swarm을 쓰는 가장 큰 이유는<br /> 여러 서버로 클러스터를 구축하여 애플리케이션을 운영할 때<br /> 더 편리하게 관리하기 위함이다.<li>노드는 서버(컴퓨터)를 의미한다.<li>Swarm 클러스터는 관리자 노드와 워커 노드로 구축할 수 있다.<li>‘기본적인 환경 설정’은 관리자 노드에서 진행하며<br /> 관리자 노드는 docker-compose yml에 따라<br /> 다른 노드를 제어한다.</ul><li>서비스 작동 방식<ul><li><a href="https://docs.docker.com/engine/swarm/how-swarm-mode-works/services/" target="_blank">서비스 작동 방식</a><li>Swarm에서 이미지를 배포하면 단일 컨테이너(Standalone container)가 아닌<br /> 서비스(Service)를 만들어 배포한다.<li>Swarm 명령어가 입력되면 관리자 노드는 서비스를 생성하고<br /> docker-compose yml 명세에 따라 각 할당 가능한 노드 별로 <br /> 적절히 컨테이너를 생성한다.<li>이때 노드 별 할당된 컨테이너를 작업(Task)라고 명명한다.<li><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://docs.docker.com/engine/swarm/images/services-diagram.png" alt="3 nginx replicas" /></ul></ul><h2 id="실험-환경">실험 환경</h2><ul><li>목표<ul><li><a href="https://coinlocker.link/">simple-locker</a>를 docker swarm mode를 사용하여 배포해보고<br /> CI / CD 파이프라인에 연동해본다.</ul><li>가정<ul><li>단일 노드에서 배포하는 것을 가정한다.<li>노드 os는 ubuntu 22.04 이다.<li>배포하고자 하는 웹 애플리케이션은 <a href="https://www.coinlocker.link/" target="_blank">simple-locker</a>이다.</ul><li>simple-locker 구조<ul><li><a href="/assets/img/2023-02-08-docker-swarm-mode-deploy-application/00-simple-locker-structure.jpg" target="_blank"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2023-02-08-docker-swarm-mode-deploy-application/00-simple-locker-structure.jpg" width="100%" /></a><li><a href="https://a3magic3pocket.github.io/posts/introduce-simple-locker/" target="_blank">simple-locker 간단한 설명</a></ul><li>docker swarm 설정 소스코드<ul><li><a href="https://github.com/a3magic3pocket/simple-docker-swarm" target="_blank">GitHub - a3magic3pocket/simple-docker-swarm: simple-docker-swarm</a></ul><li>docker-compose.yml 파일<ul><li><div class="language-yml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
</pre><td class="rouge-code"><pre>        
  <span class="c1"># docker-compose 버전</span>
  <span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.9"</span>
        
  <span class="c1"># 서비스 명세</span>
  <span class="na">services</span><span class="pi">:</span>
        
    <span class="c1"># 서비스 이름</span>
    <span class="na">web</span><span class="pi">:</span>
        
      <span class="c1"># 이미지</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">a3magic3pocket/simple-web:${WEB_TAG}</span>
        
      <span class="c1"># 환경변수</span>
      <span class="c1"># - "key=value"</span>
      <span class="na">environment</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">FRONTEND_ORIGIN=coinlocker.link"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">BACKEND_ORIGIN=api.coinlocker.link"</span>
        
      <span class="c1"># 네트워크</span>
      <span class="c1"># - 같은 네트워크에 포함된 컨테이너들은 모든 포트로 통신할 수 있다.</span>
      <span class="c1"># - 설정된 네트워크를 참조한다.</span>
      <span class="na">networks</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">simple-net</span>
        
      <span class="c1"># 배포 옵션</span>
      <span class="c1"># (swarm 모드 시에만 동작하는 설정)</span>
      <span class="na">deploy</span><span class="pi">:</span>
        <span class="na">mode</span><span class="pi">:</span> <span class="s">replicated</span>
        <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
        
        
    <span class="c1"># 서비스 이름</span>
    <span class="na">api</span><span class="pi">:</span>
        
      <span class="c1"># 이미지</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">a3magic3pocket/simple-api:${API_TAG}</span>
            
      <span class="c1"># 환경변수</span>
      <span class="na">environment</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">USE_K8S=true"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">FRONTEND_URL_LIST=https://www.coinlocker.link,https://coinlocker.link"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">GIN_MODE=release"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">IDENTITY_KEY=${IDENTITY_KEY}"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">AUTH_SECRET_KEY=${AUTH_SECRET_KEY}"</span>
        
      <span class="c1"># 네트워크</span>
      <span class="c1"># - 설정된 네트워크를 참조한다.</span>
      <span class="na">networks</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">simple-net</span>
        
      <span class="c1"># 볼륨</span>
      <span class="c1"># - 관리자 노드의 경로를 다른 서비스에서 마운트함</span>
      <span class="na">volumes</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">./sqlite3:/root/api/sqlite3</span>
        
      <span class="c1"># 배포옵션</span>
      <span class="na">deploy</span><span class="pi">:</span>
        <span class="na">mode</span><span class="pi">:</span> <span class="s">replicated</span>
        <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
        
        
    <span class="c1"># 서비스 이름</span>
    <span class="na">nginx</span><span class="pi">:</span>
        
      <span class="c1"># 이미지 </span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:1.23.3-alpine</span>
        
      <span class="c1"># 포트 </span>
      <span class="c1"># - 외부로 노출되는 port: 도커 컨테이너 포트</span>
      <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">80:80</span>
        <span class="pi">-</span> <span class="s">443:443</span>
        
      <span class="c1"># 컨피그</span>
      <span class="c1"># - 설정된 컨피그를 참조한다.</span>
      <span class="c1"># - nginx-config 파일을 target 경로에 생성한다.</span>
      <span class="na">configs</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">source</span><span class="pi">:</span> <span class="s">nginx-config</span>
          <span class="na">target</span><span class="pi">:</span> <span class="s">/etc/nginx/conf.d/default.conf</span>
        
      <span class="c1"># 네트워크   </span>
      <span class="c1"># - 설정된 네트워크를 참조한다.</span>
      <span class="na">networks</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">simple-net</span>
        
      <span class="c1"># 볼륨</span>
      <span class="na">volumes</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">/etc/letsencrypt/live/coinlocker.link/fullchain.pem:/etc/ssl/live/fullchain1.pem</span>
        <span class="pi">-</span> <span class="s">/etc/letsencrypt/live/coinlocker.link/privkey.pem:/etc/ssl/live/privkey1.pem</span>
        
      <span class="c1"># 엑스트라 호스트</span>
      <span class="c1"># /etc/hosts 파일에 추가되는 호스트.</span>
      <span class="c1"># host-gateway	host.docker.internal 가 컨테이너 내부 /etc/hosts 파일에 추가된다.</span>
      <span class="c1"># host-gateway는 manager node의 docker private ip</span>
      <span class="na">extra_hosts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">host.docker.internal:host-gateway</span>
        
  <span class="c1"># 네트워크 설정</span>
  <span class="na">networks</span><span class="pi">:</span>
    <span class="na">simple-net</span><span class="pi">:</span>
        
  <span class="c1"># 컨피그 설정</span>
  <span class="na">configs</span><span class="pi">:</span>
    <span class="na">nginx-config</span><span class="pi">:</span>
      <span class="na">file</span><span class="pi">:</span> <span class="s2">"</span><span class="s">./nginx.conf"</span>
        
</pre></table></code></div></div></ul><li>간단한 yml 파일 설명<ul><li><a href="https://docs.docker.com/compose/compose-file/compose-file-v3/" target="_blank">yml 파일 작성법</a><li>service_name &gt; image<ul><li>서비스 생성 시 참조하는 이미지이다.<li>해당 URL로 pull 하여 서비스를 생성한다.</ul><li>service_name &gt; environment<ul><li>컨테이너 내에서 할당되는 환경변수이다.<li>아래와 같이 할당한 경우<br /> 컨테이너 shell에서 echo “$FRONTEND_ORIGIN”이라는 명령을 내리면<br /> coinlocker.link가 출력된다.<div class="language-yml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>  <span class="s">some_service</span>
    <span class="s">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">FRONTEND_ORIGIN=coinlocker.link"</span>
</pre></table></code></div></div></ul><li>service_name &gt; ports<ul><li>외부로 노출되는 포트와 내부 도커 컨테이너 포트를 연결한다.<li>아래와 같이 설정한 경우<br /> 외부에서 80 포트로 요청하면 <br /> 도커 컨테이너에 1234 포트와 연결된 프로그램으로 요청이 전달된다.<div class="language-yml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>  <span class="s">some_service</span>
    <span class="s">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">80:1234</span>
</pre></table></code></div></div></ul><li>service_name &gt; networks<ul><li>동일이름의 network에 포함되는 컨테이너들은<br /> 모든 포트로 소통할 수 있다.</ul><li>service_name &gt; deploy<ul><li>swarm 모드에서만 작동하는 설정이다.<li>mode<ul><li>global과 replicated 를 고를 수 있따.<li>global은 노드 당 하나의 컨테이너만 쓴다는 의미<li>replicated는 노드 당 여러 개의 컨테이너를 쓸 수 있다는 의미</ul><li>replicas<ul><li>서비스 내에서 동작해야하는 컨테이너 수를 의미힌다.</ul></ul><li>service_name &gt; volume<ul><li>컨테이너가 참조할 볼륨을 마운트 시키는 명령이다.<li>아래와 같이 설정한 경우<br /> manager 노드의 현 위치(명령을 실행한 위치)의 디스크를<br /> 컨테이너에서 /root/api/sqlite3라는 경로에 마운트하게 된다.<div class="language-yml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>  <span class="s">some_service</span>
    <span class="s">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./sqlite3:/root/api/sqlite3</span>
</pre></table></code></div></div></ul><li>service_name &gt; configs<ul><li>컨피그는 여러 서비스에서 공통으로 참조할만한 config 정보를<br /> 저장한다.<li>서비스와 상관 없이 독립적으로 관리된다.<li>아래와 같이 설정한 경우<br /> 컨테이너가 생성될 때 nginx-config 파일을 <br /> some_service의 /etc/nginx/conf.d/default.conf에<br /> 생성하게 된다.<div class="language-yml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>  <span class="s">some_service</span>
    <span class="s">configs</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">source</span><span class="pi">:</span> <span class="s">nginx-config</span>
          <span class="na">target</span><span class="pi">:</span> <span class="s">/etc/nginx/conf.d/default.conf</span>

  <span class="na">configs</span><span class="pi">:</span>
    <span class="na">nginx-config</span><span class="pi">:</span>
    <span class="na">file</span><span class="pi">:</span> <span class="s2">"</span><span class="s">./nginx.conf"</span>
</pre></table></code></div></div></ul><li>service_name &gt; secrets<ul><li>시크릿은 여러 서비스에서 공통으로 참조할만한 secret 정보를<br /> 저장한다.<li>시크릿은 암호화되어 저장된다.<li>사용 방법은 configs와 비슷하다.</ul><li>service_name &gt; extra_hosts:<ul><li>생성되는 컨테이너의 /etc/hosts에 호스트를 추가한다.<li>아래와 같이 설정한 경우<br /> host-gateway host.docker.internal 가 <br /> 컨테이너 내부 /etc/hosts 파일에 추가된다.<div class="language-yml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>  <span class="s">some_service</span>
    <span class="s">extra_hosts</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">host.docker.internal:host-gateway</span>
</pre></table></code></div></div></ul><li>${API_TAG}, ${WEB_TAG}<ul><li>docker-compose.yml 파일에서 참조하는 환경변수이다.<li>manager 노드에서 환경변수를 설정하면<br /> docker-compse.yml에서 해당 변수를 가져와 반영한다.<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>  <span class="nb">export </span><span class="nv">API_TAG</span><span class="o">=</span>0.0.7
  <span class="nb">export </span><span class="nv">WEB_TAG</span><span class="o">=</span>0.0.19
</pre></table></code></div></div></ul></ul><li>기본적인 배포 방법<ul><li>stack 배포<ul><li>yml 파일에 기록된 모든 것을 자동으로 세팅해준다.<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>  <span class="c"># 환경변수 선언</span>
  <span class="nb">export </span><span class="nv">API_TAG</span><span class="o">=</span>0.0.7
  <span class="nb">export </span><span class="nv">WEB_TAG</span><span class="o">=</span>0.0.19

  <span class="c"># stack 배포</span>
  docker stack deploy <span class="nt">-c</span> docker-compose.yml <span class="o">[</span>stack 이름]

  <span class="c"># stack 목록 조회</span>
  docker stack <span class="nb">ls</span>

  <span class="c"># stack 삭제</span>
  docker stack <span class="nb">rm</span> <span class="o">[</span>stack 이름]
</pre></table></code></div></div></ul><li>서비스 이미지만 변경<ul><li>이미 배포된 서비스에서 이미지만 업데이트하는 것을 말한다.<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>  <span class="c"># service 목록 조회</span>
  docker service <span class="nb">ls</span>

  <span class="c"># service 업데이트</span>
  docker service update <span class="nt">--image</span> <span class="o">[</span>이미지 URL] <span class="o">[</span>service 이름]

  <span class="c"># service 삭제</span>
  docker service <span class="nb">rm</span> <span class="o">[</span>service 이름]
</pre></table></code></div></div></ul></ul><li>deploy.sh<ul><li>설명<ul><li>배포 과정을 단순화하기 위해 모드에 따라 자동으로 처리되도록<br /> 작성한 스크립트<li>모드는 stack, service:api, service:web이다.<li>공통<ul><li>simple-docker-swarm 하위의<br /> simple-api-example과 simple-web-example의 git repository를<br /> 최신화한다.<li>최신화된 git repository에서 각각 이미지 tag를 뽑은 뒤<br /> 현재 서비스에 사용하고 있는 이미지 tag와 비교한다.<br /> 비교한 결과 차이가 없다면 배포를 중단한다.</ul><li>stack<ul><li>같은 이름으로 stack 배포를 진행하면 바뀐 부분만 업데이트한다.<li>그러나 가끔씩 이미 생성된 네트워크나 시크릿이 존재한다며<br /> 배포가 되지 않을 때가 있다.<li>이를 막기 위해 여기서는 stack을 삭제하고 새로 배포한다.<br /> 이때 웹 접속이 잠시동안 되지 않는다.</ul><li>service:api<ul><li>simpel-api-example의 git repository에서<br /> simpe-api.yml에 있는 image URL을 획득한다.<li>해당 URL로 기존에 존재하는 service의 이미지를 업데이트한다.</ul><li>service:web<ul><li>simpel-web-example의 git repository에서<br /> simpe-web.yml에 있는 image URL을 획득한다.<li>해당 URL로 기존에 존재하는 service의 이미지를 업데이트한다.</ul></ul><li>코드<ul><li>deploy.sh<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
</pre><td class="rouge-code"><pre>  <span class="c">#!/usr/bin/env bash</span>
  <span class="nv">STACK_NAME</span><span class="o">=</span>a3
  <span class="nv">WORKING_DIR_PATH</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">dirname</span> <span class="nv">$0</span><span class="si">)</span><span class="s2">"</span>
  <span class="nv">API_DIR_PATH</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">WORKING_DIR_PATH</span><span class="k">}</span><span class="s2">/simple-api-example"</span>
  <span class="nv">WEB_DIR_PATH</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">WORKING_DIR_PATH</span><span class="k">}</span><span class="s2">/simple-web-example"</span>
  <span class="nb">export </span><span class="nv">IDENTITY_KEY</span><span class="o">=</span><span class="sb">`</span><span class="nb">cat</span> <span class="k">${</span><span class="nv">WORKING_DIR_PATH</span><span class="k">}</span>/secrets/IDENTITY_KEY<span class="sb">`</span>
  <span class="nb">export </span><span class="nv">AUTH_SECRET_KEY</span><span class="o">=</span><span class="sb">`</span><span class="nb">cat</span> <span class="k">${</span><span class="nv">WORKING_DIR_PATH</span><span class="k">}</span>/secrets/AUTH_SECRET_KEY<span class="sb">`</span>
            
  <span class="c"># 초기화, git 최신화</span>
  <span class="k">function </span>git_init <span class="o">{</span>
      git <span class="nt">--git-dir</span><span class="o">=</span><span class="k">${</span><span class="nv">API_DIR_PATH</span><span class="k">}</span>/.git pull origin main
      git <span class="nt">--git-dir</span><span class="o">=</span><span class="k">${</span><span class="nv">WEB_DIR_PATH</span><span class="k">}</span>/.git pull origin main
  <span class="o">}</span>
            
  <span class="c"># API_TAG, WEB_TAG 할당</span>
  <span class="k">function </span>set_tags <span class="o">{</span>
      <span class="nv">api_image_url</span><span class="o">=</span><span class="sb">`</span>get_image_url <span class="k">${</span><span class="nv">API_DIR_PATH</span><span class="k">}</span>/simple-api.yml api<span class="sb">`</span>
      <span class="nv">web_image_url</span><span class="o">=</span><span class="sb">`</span>get_image_url <span class="k">${</span><span class="nv">WEB_DIR_PATH</span><span class="k">}</span>/simple-web.yml web<span class="sb">`</span>
      <span class="nb">export </span><span class="nv">API_TAG</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="k">${</span><span class="nv">api_image_url</span><span class="k">}</span> | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s2">":"</span> <span class="nt">-f</span> 2<span class="sb">`</span>
      <span class="nb">export </span><span class="nv">WEB_TAG</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="k">${</span><span class="nv">web_image_url</span><span class="k">}</span> | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s2">":"</span> <span class="nt">-f</span> 2<span class="sb">`</span>
  <span class="o">}</span>
            
  <span class="c"># 새 이미지가 업데이트 되었는지 확인</span>
  <span class="k">function </span>is_image_updated <span class="o">{</span>
      <span class="nb">local </span><span class="nv">is_different</span><span class="o">=</span>0
            
      <span class="nb">declare</span> <span class="nt">-a</span> <span class="nv">arr</span><span class="o">=(</span><span class="s2">"simple-api:</span><span class="k">${</span><span class="nv">API_TAG</span><span class="k">}</span><span class="s2">"</span> <span class="s2">"simple-web:</span><span class="k">${</span><span class="nv">WEB_TAG</span><span class="k">}</span><span class="s2">"</span><span class="o">)</span>
            
      <span class="k">for </span>row <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">arr</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span>
      <span class="k">do
          </span><span class="nb">local </span><span class="nv">prefix</span><span class="o">=</span><span class="k">${</span><span class="nv">row</span><span class="p">%%</span>:<span class="p">*</span><span class="k">}</span>
          <span class="nb">local </span><span class="nv">yml_tag</span><span class="o">=</span><span class="k">${</span><span class="nv">row</span><span class="p">##*</span>:<span class="k">}</span>
            
          <span class="nb">local </span><span class="nv">current_tag</span><span class="o">=</span><span class="sb">`</span>docker ps | <span class="nb">grep</span> <span class="k">${</span><span class="nv">prefix</span><span class="k">}</span> | <span class="nb">awk</span> <span class="nt">-F</span> <span class="s1">' '</span> <span class="s1">'{ print $2 }'</span> | <span class="nb">awk</span> <span class="nt">-F</span> <span class="s1">':'</span> <span class="s1">'{ print $2 }'</span><span class="sb">`</span>
            
          <span class="k">if</span> <span class="o">[[</span> <span class="k">${</span><span class="nv">current_tag</span><span class="k">}</span> <span class="o">!=</span> <span class="k">${</span><span class="nv">yml_tag</span><span class="k">}</span> <span class="o">]]</span><span class="p">;</span><span class="k">then
              </span><span class="nv">is_different</span><span class="o">=</span>1
              <span class="nb">break
          </span><span class="k">fi
      done
            
      return</span> <span class="k">${</span><span class="nv">is_different</span><span class="k">}</span>
  <span class="o">}</span>
            
  <span class="c"># 초기 세팅</span>
  <span class="k">function </span>init <span class="o">{</span>
      git_init
      set_tags
      is_image_updated
            
      <span class="nb">local </span><span class="nv">is_different</span><span class="o">=</span><span class="nv">$?</span>
      <span class="k">if</span> <span class="o">[[</span> <span class="k">${</span><span class="nv">is_different</span><span class="k">}</span> <span class="nt">-eq</span> 0 <span class="o">]]</span><span class="p">;</span><span class="k">then
          </span><span class="nb">echo</span> <span class="s2">"image is not updated"</span>
          <span class="nb">exit </span>1<span class="p">;</span>
      <span class="k">fi</span>
  <span class="o">}</span>
            
  <span class="c"># api, web manifest 파일에서 이미지 URL 추출</span>
  <span class="k">function </span>get_image_url <span class="o">{</span>
      <span class="nb">local </span><span class="nv">yml_file_path</span><span class="o">=</span><span class="nv">$1</span>
      <span class="nb">local </span><span class="nv">keyword</span><span class="o">=</span><span class="nv">$2</span>
            
      <span class="nv">line</span><span class="o">=</span><span class="sb">`</span><span class="nb">cat</span> <span class="k">${</span><span class="nv">yml_file_path</span><span class="k">}</span> | <span class="nb">grep</span> <span class="s2">"image: "</span> | <span class="nb">grep</span> <span class="k">${</span><span class="nv">keyword</span><span class="k">}</span><span class="sb">`</span>
      <span class="nv">prefix</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="k">${</span><span class="nv">line</span><span class="k">}</span> | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s2">":"</span> <span class="nt">-f</span> 2<span class="sb">`</span>
      <span class="nv">tag</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="k">${</span><span class="nv">line</span><span class="k">}</span> | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s2">":"</span> <span class="nt">-f</span> 3<span class="sb">`</span>
            
      <span class="nb">echo</span> <span class="k">${</span><span class="nv">prefix</span><span class="k">}</span>:<span class="k">${</span><span class="nv">tag</span><span class="k">}</span>
  <span class="o">}</span>
            
  <span class="c"># 스택배포</span>
  <span class="k">function </span>deploy_stack <span class="o">{</span>
      docker stack <span class="nb">rm</span> <span class="k">${</span><span class="nv">STACK_NAME</span><span class="k">}</span>
                
      <span class="k">while</span> <span class="o">[[</span> <span class="si">$(</span>docker network <span class="nb">ls</span> | <span class="nb">grep</span> <span class="s2">"</span><span class="k">${</span><span class="nv">STACK_NAME</span><span class="k">}</span><span class="s2">_"</span> | <span class="nb">wc</span> <span class="nt">-c</span><span class="si">)</span> <span class="nt">-ne</span> 0 <span class="o">]]</span><span class="p">;</span>
      <span class="k">do
          </span><span class="nb">sleep </span>1<span class="p">;</span>
      <span class="k">done
                
      </span>docker stack deploy <span class="nt">-c</span> docker-compose.yml <span class="k">${</span><span class="nv">STACK_NAME</span><span class="k">}</span>
  <span class="o">}</span>
            
  <span class="c"># 서비스배포</span>
  <span class="k">function </span>deploy_service <span class="o">{</span>
      <span class="nb">local </span><span class="nv">service_suffix</span><span class="o">=</span><span class="nv">$1</span>
      <span class="nb">local </span><span class="nv">image_url</span><span class="o">=</span><span class="s2">""</span>
      <span class="k">if</span> <span class="o">[[</span> <span class="nv">$service_suffix</span> <span class="o">=</span> <span class="s2">"api"</span> <span class="o">]]</span><span class="p">;</span><span class="k">then
          </span><span class="nv">image_url</span><span class="o">=</span><span class="sb">`</span>get_image_url <span class="k">${</span><span class="nv">API_DIR_PATH</span><span class="k">}</span>/simple-api.yml api<span class="sb">`</span>
      <span class="k">elif</span> <span class="o">[[</span> <span class="nv">$service_suffix</span> <span class="o">=</span> <span class="s2">"web"</span> <span class="o">]]</span><span class="p">;</span><span class="k">then
          </span><span class="nv">image_url</span><span class="o">=</span><span class="sb">`</span>get_image_url <span class="k">${</span><span class="nv">WEB_DIR_PATH</span><span class="k">}</span>/simple-web.yml web<span class="sb">`</span>
      <span class="k">else
          </span><span class="nb">echo</span> <span class="s2">"deploy_service::service_suffix is not allowed. </span><span class="k">${</span><span class="nv">service_suffix</span><span class="k">}</span><span class="s2">"</span>
          <span class="nb">exit </span>1<span class="p">;</span>
      <span class="k">fi
            
      </span>docker service update <span class="nt">--image</span> <span class="k">${</span><span class="nv">image_url</span><span class="k">}</span> <span class="s2">"</span><span class="k">${</span><span class="nv">STACK_NAME</span><span class="k">}</span><span class="s2">_</span><span class="k">${</span><span class="nv">service_suffix</span><span class="k">}</span><span class="s2">"</span>
  <span class="o">}</span>
            
  <span class="c"># 도움말</span>
  <span class="k">function </span><span class="nb">help</span> <span class="o">{</span>
      <span class="nb">echo</span> <span class="s2">"+----- HOW TO RUN -----+"</span>
      <span class="nb">echo</span> <span class="s2">"ex) bash deploy.sh &lt;mode&gt;"</span>
      <span class="nb">echo</span> <span class="s2">"    allowed mode = [stack, service:api, service:web]"</span>
      <span class="nb">echo</span> <span class="s2">"+----------------------+"</span>
  <span class="o">}</span>
            
  <span class="c"># secret 파일 존재 유무 확인</span>
  <span class="k">if</span> <span class="o">[[</span> <span class="k">${</span><span class="nv">IDENTITY_KEY</span><span class="k">}</span> <span class="o">=</span> <span class="s2">""</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
      </span><span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">WORKING_DIR_PATH</span><span class="k">}</span><span class="s2">/secrets/IDENTITY_KEY is empty"</span>
      <span class="nb">exit </span>1
  <span class="k">fi
  if</span> <span class="o">[[</span> <span class="k">${</span><span class="nv">AUTH_SECRET_KEY</span><span class="k">}</span> <span class="o">=</span> <span class="s2">""</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
      </span><span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">WORKING_DIR_PATH</span><span class="k">}</span><span class="s2">/secrets/AUTH_SECRET_KEY is empty"</span>
      <span class="nb">exit </span>1
  <span class="k">fi</span>
            
  <span class="c"># 실행</span>
  <span class="k">if</span> <span class="o">[[</span> <span class="nv">$1</span> <span class="o">=</span> <span class="s2">"stack"</span> <span class="o">]]</span><span class="p">;</span><span class="k">then
      </span>init
      deploy_stack
  <span class="k">elif</span> <span class="o">[[</span> <span class="nv">$1</span> <span class="o">=</span> <span class="s2">"service:api"</span> <span class="o">]]</span><span class="p">;</span><span class="k">then
      </span>init
      deploy_service <span class="s2">"api"</span>
  <span class="k">elif</span> <span class="o">[[</span> <span class="nv">$1</span> <span class="o">=</span> <span class="s2">"service:web"</span> <span class="o">]]</span><span class="p">;</span><span class="k">then 
      </span>init
      deploy_service <span class="s2">"web"</span>
  <span class="k">else
      </span><span class="nb">echo</span> <span class="s2">"mode is empty"</span>
      <span class="nb">help
  </span><span class="k">fi</span>
</pre></table></code></div></div></ul></ul><li>nginx 설정<ul><li>설명<ul><li>리버스 프록시 서버<li>server_name에 따라 api와 web, webhook 서버로 각각 전달한다.<li>여기서 api, web은 docker-compose에서 설정한 host name이다.<li>host.docker.internal은 manger node의 docker private ip로<br /> webhook 서버가 manager node에서 실행 중이므로<br /> nginx는 host.docker.internal을 통해 webhook 서버로 요청을 넘긴다.<li>80 포트로 들어온 모든 http 요청은 433포트로 redirect 한다.</ul><li>코드<ul><li>nginx.conf<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
</pre><td class="rouge-code"><pre>  server <span class="o">{</span>
      listen 80 default_server<span class="p">;</span>
            
      server_name _<span class="p">;</span>
            
      <span class="k">return </span>301 https://<span class="nv">$host$request_uri</span><span class="p">;</span>
  <span class="o">}</span>
            
  server <span class="o">{</span>
      listen 443 ssl<span class="p">;</span>
            
      server_name api.coinlocker.link<span class="p">;</span>
      underscores_in_headers on<span class="p">;</span>
      server_tokens off<span class="p">;</span>
      <span class="c">#ignore_invalid_headers off;</span>
            
      ssl_certificate /etc/ssl/live/fullchain1.pem<span class="p">;</span>
      ssl_certificate_key /etc/ssl/live/privkey1.pem<span class="p">;</span>
            
      location / <span class="o">{</span>
          proxy_set_header    host    <span class="nv">$host</span><span class="p">;</span>
          proxy_set_header    X-Real-IP           <span class="nv">$remote_addr</span><span class="p">;</span>
          proxy_set_header    X-Forwarded-For     <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>        
          proxy_pass_request_headers  on<span class="p">;</span>
          proxy_pass  http://api:8080/<span class="p">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
            
  server <span class="o">{</span>
      listen 443 ssl<span class="p">;</span>
            
      server_name webhook.coinlocker.link<span class="p">;</span>
      underscores_in_headers on<span class="p">;</span>
      server_tokens off<span class="p">;</span>
      <span class="c">#ignore_invalid_headers off;</span>
            
      ssl_certificate /etc/ssl/live/fullchain1.pem<span class="p">;</span>
      ssl_certificate_key /etc/ssl/live/privkey1.pem<span class="p">;</span>
            
      location / <span class="o">{</span>
          proxy_set_header    host    <span class="nv">$host</span><span class="p">;</span>
          proxy_set_header    X-Real-IP           <span class="nv">$remote_addr</span><span class="p">;</span>
          proxy_set_header    X-Forwarded-For     <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>        
          proxy_pass_request_headers  on<span class="p">;</span>
          proxy_pass  http://host.docker.internal:9000<span class="p">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
            
  server <span class="o">{</span>
      listen 443 ssl<span class="p">;</span>
            
      server_name www.coinlocker.link coinlocker.link<span class="p">;</span>
      underscores_in_headers on<span class="p">;</span>
      server_tokens off<span class="p">;</span>
      <span class="c">#ignore_invalid_headers off;</span>
            
      ssl_certificate /etc/ssl/live/fullchain1.pem<span class="p">;</span>
      ssl_certificate_key /etc/ssl/live/privkey1.pem<span class="p">;</span>
            
      location / <span class="o">{</span>
          proxy_set_header    host    <span class="nv">$host</span><span class="p">;</span>
          proxy_set_header    X-Real-IP           <span class="nv">$remote_addr</span><span class="p">;</span>
          proxy_set_header    X-Forwarded-For     <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>        
          proxy_pass_request_headers  on<span class="p">;</span>
          proxy_pass http://web:3000<span class="p">;</span>
      <span class="o">}</span>
  <span class="o">}</span>
</pre></table></code></div></div></ul></ul><li>Webhook 서버 실행<ul><li><a href="https://a3magic3pocket.github.io/posts/cicd-using-git-action-and-dockerhub/" target="_blank">git action과 dockerhub을 이용한 CI/CD 파이프라인 구축</a><li>CI / CD 파이프라인 중 한 모듈로<br /> dockerhub에서 새 이미지가 push되어 보내는 webhook 명령을<br /> 받아서 실제 서버에 배포하는 서버이다.</ul><li>ssl 갱신<ul><li>ssl 인증서는 certbot을 이용하여 생성 및 갱신하고 있다.<li>cerbot은 dns 인증방식을 통해 ssl을 인증 받았으며<br /> 갱신은 crontab으로 등록하여 주기적으로 갱신되도록 하였다.<li>cerbot은 manager 노드에서 실행되어 ssl 인증서를 생성 및 갱신한다.<br /> nginx 서비스는 ssl이 포함된 경로를 마운트하여 ssl을 지원한다.<li>set_ssh.sh<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre>  <span class="k">function </span>init_ssl <span class="o">{</span>
      <span class="c"># Reference by:</span>
      <span class="c">#   https://lynlab.co.kr/blog/72</span>
      <span class="c">#   https://www.lesstif.com/system-admin/dns-txt-record-let-s-encrypt-ssl-59343172.html</span>
      <span class="c">#   https://oasisfores.com/letsencrypt-wildcard-ssl-certificate/</span>
      docker run <span class="nt">-it</span> <span class="nt">--rm</span> <span class="nt">--name</span> certbot <span class="se">\</span>
        <span class="nt">-v</span> <span class="s1">'/etc/letsencrypt:/etc/letsencrypt'</span> <span class="se">\</span>
        <span class="nt">-v</span> <span class="s1">'/var/lib/letsencrypt:/var/lib/letsencrypt'</span> <span class="se">\</span>
        certbot/certbot certonly <span class="nt">-d</span> <span class="s1">'*.coinlocker.link'</span> <span class="nt">-d</span> <span class="s1">'coinlocker.link'</span> <span class="nt">--manual</span> <span class="nt">--preferred-challenges</span> dns <span class="nt">--server</span> https://acme-v02.api.letsencrypt.org/directory
  <span class="o">}</span>

  <span class="k">function </span>renew_ssl <span class="o">{</span>
      docker run <span class="nt">-it</span> <span class="nt">--rm</span> <span class="nt">--name</span> certbot <span class="se">\</span>
        <span class="nt">-v</span> <span class="s1">'/etc/letsencrypt:/etc/letsencrypt'</span> <span class="se">\</span>
        <span class="nt">-v</span> <span class="s1">'/var/lib/letsencrypt:/var/lib/letsencrypt'</span> <span class="se">\</span>
        certbot/certbot renew <span class="nt">--manual</span> <span class="nt">--preferred-challenges</span> dns <span class="nt">--server</span> https://acme-v02.api.letsencrypt.org/directory
  <span class="o">}</span>

  <span class="k">if</span> <span class="o">[[</span> <span class="nv">$1</span> <span class="o">=</span> <span class="s2">"init"</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
      </span>init_ssl
  <span class="k">elif</span> <span class="o">[[</span> <span class="nv">$1</span> <span class="o">=</span> <span class="s2">"renew"</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
      </span>renew_ssl
  <span class="k">else
      </span><span class="nb">echo</span> <span class="s2">"argument is not allowed"</span>
      <span class="nb">echo</span> <span class="s2">"allowed argument: [init, renew]"</span>
      <span class="nb">echo</span> <span class="s2">"ex. bash set_ssl.sh init"</span>
  <span class="k">fi</span>
</pre></table></code></div></div><li>crontab<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>  0 0 1 <span class="k">*</span>/2 <span class="k">*</span> /usr/bin/env bash /home/ubuntu/simple-docker-swarm/set_ssl.sh renew <span class="o">&amp;&amp;</span> docker service update a3_nginx
</pre></table></code></div></div></ul></ul><h2 id="실험시작">실험시작</h2><ul><li>swarm mode 시작<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>  docker swarm init
</pre></table></code></div></div><li>github 소스 내려 받기<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>  <span class="c"># git clone</span>
  git clone https://github.com/a3magic3pocket/simple-docker-swarm.git

  <span class="c"># clone 받은 디렉토리로 이동</span>
  <span class="nb">cd</span> ./simple-docker-swarm
</pre></table></code></div></div><li>의존성 패키지 설치<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>  <span class="nb">sudo </span>apt-get update 
  <span class="nb">sudo </span>apt-get upgrade 

  <span class="c"># 도커 설치 </span>
  curl <span class="nt">-fsSL</span> https://get.docker.com <span class="nt">-o</span> get-docker.sh <span class="nv">DRY_RUN</span><span class="o">=</span>1 <span class="nb">sudo </span>sh ./get-docker.sh 

  <span class="c"># 웹훅 서버 설치 </span>
  <span class="nb">sudo </span>apt-get <span class="nb">install </span>webhook
</pre></table></code></div></div><li>Webhook 서버 실행<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>  bash run_webhook.sh
</pre></table></code></div></div><li>docker-compose를 바탕으로 stack 생성<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>  bash deploy.sh stack
</pre></table></code></div></div><li>잘 생성되었나 확인<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>  <span class="c"># stack 생성 확인</span>
  docker stack <span class="nb">ls</span>

  <span class="c"># service 생성 확인</span>
  <span class="c"># 이때 서비스의 REPLICAS가 0/1 이면 아직 생성되고 있다는 뜻</span>
  docker service <span class="nb">ls</span>

  <span class="c"># watch 명령어로 모든 서비스가 1/1이 될때까지 대기 후 확인</span>
  watch docker service <span class="nb">ls</span>
</pre></table></code></div></div><li>다중 노드 사용 시 유의사항<ul><li>설명<ul><li>다중 노드로 애플리케이션을 배포 및 운영하고 계신<br /> 동료 프로그래머에게 몇 가지 유의사항을 들어 기록한다.</ul><li>replicas 수<ul><li>다중 노드 사용 시<br /> manager 노드가 할당 가능한 노드에 replicas를 임의로 분배한다.<li>max_replicas_per_node를 설정해주면<br /> 한 노드 당 가질 수 있는 최대 replicas를 설정하여 골고루 분배할 수 있다.<li>만일 (할당 가능한 노드 * max_replicas_per_node 수 &lt; 서비스 내의 <br /> 모든 replicas 수) 이면 에러가 나게 되니 주의<li>명령어<div class="language-yml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>  <span class="na">some_service</span><span class="pi">:</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">mode</span><span class="pi">:</span> <span class="s">replicated</span>
      <span class="na">replicas</span><span class="pi">:</span> <span class="m">6</span>
      <span class="na">placement</span><span class="pi">:</span>
        <span class="na">max_replicas_per_node</span><span class="pi">:</span> <span class="m">1</span>
</pre></table></code></div></div></ul></ul><li>노드 status 세팅<ul><li>reachable 상태로 두면<br /> 만약 manager 노드가 죽었을 경우<br /> reachable 노드가 대신 manager가 된다.<li>worker 노드는 manager 노드가 될 수 없다.<li>명령어<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>  <span class="c"># 노드 상태 보기</span>
  <span class="c"># - 여기서 'MANAGER STATUS'를 참고하면 된다.</span>
  docker node <span class="nb">ls</span>

  <span class="c"># node를 worker node로 만들기</span>
  docker node demote <span class="o">[</span>node <span class="nb">id</span><span class="o">]</span>

  <span class="c"># node를 reachable node로 승격시키기</span>
  docker node promote <span class="o">[</span>node <span class="nb">id</span><span class="o">]</span>
</pre></table></code></div></div></ul></ul><h2 id="참고">참고</h2><ul><li><a href="https://seongjin.me/docker-swarm-introduction-nodes/" target="_blank">Docker Swarm의 주요 용어, 활성화 방법 및 노드(Node) 관리법 살펴보기</a><li><a href="https://www.redhat.com/ko/topics/containers/what-is-container-orchestration" target="_blank">컨테이너 오케스트레이션이란?</a><li><a href="https://docs.docker.com/engine/swarm/how-swarm-mode-works/services/" target="_blank">서비스 작동 방식</a><li><a href="https://docs.docker.com/compose/compose-file/compose-file-v3/" target="_blank">yml 파일 작성법</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/docker/'>Docker</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/docker/" class="post-tag no-text-decoration" >docker</a> <a href="/tags/docker-swarm/" class="post-tag no-text-decoration" >docker-swarm</a> <a href="/tags/git/" class="post-tag no-text-decoration" >git</a> <a href="/tags/git-action/" class="post-tag no-text-decoration" >git-action</a> <a href="/tags/dockerhub/" class="post-tag no-text-decoration" >dockerhub</a> <a href="/tags/cicd/" class="post-tag no-text-decoration" >cicd</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Docker swarm mode을 이용하여 웹 애플리케이션 운영하기 - 의사줌치&url=https://a3magic3pocket.github.io/posts/docker-swarm-mode-deploy-application/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Docker swarm mode을 이용하여 웹 애플리케이션 운영하기 - 의사줌치&u=https://a3magic3pocket.github.io/posts/docker-swarm-mode-deploy-application/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Docker swarm mode을 이용하여 웹 애플리케이션 운영하기 - 의사줌치&url=https://a3magic3pocket.github.io/posts/docker-swarm-mode-deploy-application/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/kafka-large-scale-event-processing-architecture-and-performance-comparison/">Kafka를 활용한 대용량 이벤트 처리 구조 설계와 성능 비교</a><li><a href="/posts/experimenting-with-blue-green-deployments/">블루 - 그린 배포 실험</a><li><a href="/posts/spring-kafka-latest-message-pub-sub-config/">Spring Kafka에서 최신 메시지만 소비하는 Pub/Sub 방식 설정</a><li><a href="/posts/solving-concurrency-problems-with-performance-in-mind/">동시성 문제 해결 방안 성능 실험</a><li><a href="/posts/exploring-authentication-options/">인증방식 고민</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/kafka/">kafka</a> <a class="post-tag" href="/tags/kotlin/">kotlin</a> <a class="post-tag" href="/tags/elasticsearch/">elasticsearch</a> <a class="post-tag" href="/tags/elk/">elk</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/summary/">summary</a> <a class="post-tag" href="/tags/git/">git</a> <a class="post-tag" href="/tags/kafka-streams/">kafka-streams</a> <a class="post-tag" href="/tags/nest/">nest</a> <a class="post-tag" href="/tags/react/">react</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/kubernetes-deploy-application/"><div class="card-body"> <span class="timeago small" > Feb 14, 2023 <i class="unloaded">2023-02-14T00:42:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Kubernetes(minikube)를 이용하여 웹 애플리케이션 운영하기</h3><div class="text-muted small"><p> Kubernetes란 쿠버네티스란 무엇인가? 컨테이너 오케스트레이션 툴이다. 쿠버네티스는 Docker swarm mode와 비슷하나 대규모 애플리케이션에 보다 더 적합하다. Docker Swarm vs Kubernetes: how to choose a container orchestration tool ...</p></div></div></a></div><div class="card"> <a href="/posts/cicd-using-git-action-and-dockerhub/"><div class="card-body"> <span class="timeago small" > Feb 5, 2023 <i class="unloaded">2023-02-05T12:49:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>git action과 dockerhub을 이용한 CI/CD 파이프라인 구축</h3><div class="text-muted small"><p> CI/CD란 상세한 정의 Red Hat 문서에 상세하게 잘 적혀있다. CI/CD(CI CD, 지속적 통합/지속적 배포): 개념, 툴, 구축, 차이 (redhat.com) CI/CD 파이프라인: 개념, 방법, 장점, 구현 과정 (redhat.com) ...</p></div></div></a></div><div class="card"> <a href="/posts/how-to-make-jekyll-blog/"><div class="card-body"> <span class="timeago small" > Oct 23, 2020 <i class="unloaded">2020-10-23T12:56:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Jekyll을 이용하여 Github 블로그 만들기(with windows, docker)</h3><div class="text-muted small"><p> 개요 전반적 구성 Jekyll을 이용하여 웹 사이트에 필요한 정적(static) 파일을 생성한다(ex. html, css, js, img 등) Github에 정적 파일 호스팅을 시도한다. 매번 Github에 올려서 확인하기 어려움으로 로컬 환경을 구축하여 로컬에서 확인 후 Github에 올린다. ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/introduce-simple-locker/" class="btn btn-outline-primary" prompt="Older"><p>SIMPLE-LOCKER 간단한 설명</p></a> <a href="/posts/kubernetes-deploy-application/" class="btn btn-outline-primary" prompt="Newer"><p>Kubernetes(minikube)를 이용하여 웹 애플리케이션 운영하기</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/a3magic3pocket">의사줌치</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/kafka/">kafka</a> <a class="post-tag" href="/tags/kotlin/">kotlin</a> <a class="post-tag" href="/tags/elasticsearch/">elasticsearch</a> <a class="post-tag" href="/tags/elk/">elk</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/summary/">summary</a> <a class="post-tag" href="/tags/git/">git</a> <a class="post-tag" href="/tags/kafka-streams/">kafka streams</a> <a class="post-tag" href="/tags/nest/">nest</a> <a class="post-tag" href="/tags/react/">react</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://a3magic3pocket.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
