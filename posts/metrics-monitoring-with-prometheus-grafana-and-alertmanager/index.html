<!DOCTYPE html><html lang="ko-KR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="메트릭 모니터링(prometheus, grafana, alertmanager)" /><meta property="og:locale" content="ko_KR" /><meta name="description" content="정의 시스템 상태와 성능을 지속적으로 관찰하고 분석하는 과정 이를 통해 문제를 조기에 발견하는 것을 목표로 한다." /><meta property="og:description" content="정의 시스템 상태와 성능을 지속적으로 관찰하고 분석하는 과정 이를 통해 문제를 조기에 발견하는 것을 목표로 한다." /><link rel="canonical" href="https://a3magic3pocket.github.io/posts/metrics-monitoring-with-prometheus-grafana-and-alertmanager/" /><meta property="og:url" content="https://a3magic3pocket.github.io/posts/metrics-monitoring-with-prometheus-grafana-and-alertmanager/" /><meta property="og:site_name" content="의사줌치" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-04-06T08:49:51+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="메트릭 모니터링(prometheus, grafana, alertmanager)" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"정의 시스템 상태와 성능을 지속적으로 관찰하고 분석하는 과정 이를 통해 문제를 조기에 발견하는 것을 목표로 한다.","url":"https://a3magic3pocket.github.io/posts/metrics-monitoring-with-prometheus-grafana-and-alertmanager/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://a3magic3pocket.github.io/posts/metrics-monitoring-with-prometheus-grafana-and-alertmanager/"},"headline":"메트릭 모니터링(prometheus, grafana, alertmanager)","dateModified":"2025-04-11T22:27:26+09:00","datePublished":"2025-04-06T08:49:51+09:00","@context":"https://schema.org"}</script><title>메트릭 모니터링(prometheus, grafana, alertmanager) | 의사줌치</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="의사줌치"><meta name="application-name" content="의사줌치"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-5NQ41XXW83"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-5NQ41XXW83'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/sample/avatar-crop.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">의사줌치</a></div><div class="site-subtitle font-italic">부정확한 정보를 <br /> 담고 있을 수 있습니다.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/a3magic3pocket" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['a3magic3pocket','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>메트릭 모니터링(prometheus, grafana, alertmanager)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>메트릭 모니터링(prometheus, grafana, alertmanager)</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> 의사줌치 </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Apr 6, 2025, 8:49 AM +0900" prep="on" > Apr 6 <i class="unloaded">2025-04-06T08:49:51+09:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Fri, Apr 11, 2025, 10:27 PM +0900" prefix="Updated " > Apr 11 <i class="unloaded">2025-04-11T22:27:26+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3311 words">18 min</span></div></div><div class="post-content"><h2 id="정의">정의</h2><ul><li>시스템 상태와 성능을 지속적으로 관찰하고 분석하는 과정<br /> 이를 통해 문제를 조기에 발견하는 것을 목표로 한다.</ul><h2 id="메트릭metric이란">메트릭(metric)이란</h2><ul><li>시스템, 애플리케이션 또는 프로세스의 성능이나 상태를 <br /> 수치적으로 표현한 데이터 포인트<li>우리는 메트릭을 지속적으로 수집하여<br /> 문제 발생 시 경고(alert)을 보내거나<br /> 시각화하여 문제를 빠르게 판단하는 시스템을 구축한다.</ul><h2 id="사용툴">사용툴</h2><ul><li>프로메테우스(prometheus)<ul><li>메트릭 수집 및 저장</ul><li>그라파나(grafana)<ul><li>메트릭을 시각화</ul><li>얼럿매니저(alertmanager)<ul><li>메트릭 조건식을 지정하여 조건식을 만족하면 메신저로 메세지 전송</ul></ul><h2 id="프로메테우스-메트릭-익스포터metric-exporter-종류">프로메테우스 메트릭 익스포터(metric exporter) 종류</h2><ul><li>node_exporter: 시스템 메트릭을 수집한다<li>spring_exporter: 스프링 애플리케이션 매트릭을 수집힌다.</ul><h2 id="node_exporter-메트릭">node_exporter 메트릭</h2><ul><li>주요 기능<ul><li>CPU, 메모리, 디스크, 네트워크 대역폭, node_exporter의 gc(garbage collection)</ul><li>주요 메트릭<ul><li>CPU 사용률<ul><li>(sum(rate(node_cpu_seconds_total{mode!=”idle”}[5m])) by (instance))</ul><li>사용 가능한 메모리 비율<ul><li>(node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)</ul><li>디스크 사용률<ul><li>(node_filesystem_size_bytes - node_filesystem_avail_bytes) / node_filesystem_size_bytes</ul><li>네트워크 평균 수신 속도(최근 1시간)<ul><li>avg_over_time(rate(node_network_receive_bytes_total[5m])[1h:5m])</ul><li>node_exporter 평균 gc 시간<ul><li>avg(rate(go_gc_duration_seconds[5m])) by (instance)</ul></ul><li>참고<ul><li><a href="https://prometheus.io/docs/guides/node-exporter/" target="_blank">설치가이드 및 메트릭 설명</a></ul></ul><h2 id="spring_exporter-메트릭">spring_exporter 메트릭</h2><ul><li>주요 기능<ul><li>HTTP 요청, JVM, gc, 활성스레드, 스프링 CPU 사용량, 스프링 디스크 I/O<li>CPU와 디스크는 node_exporter로 대체 가능</ul><li>주요 메트릭<ul><li>HTTP 요청 처리 시간(초)<ul><li>sum(http_server_requests_seconds_sum) by (instance) / sum(http_server_requests_seconds_count) by (instance)</ul><li>HTTP 요청 수<ul><li>(rate(http_server_requests_seconds_count[5m]))</ul><li>HTTP 오류 요청 비율<ul><li>(sum(rate(http_server_requests_seconds_count{status=~”5..”}[5m])) by (instance) / sum(rate(http_server_requests_seconds_count[5m])) by (instance))</ul><li>JVM 힙 메모리 사용률<ul><li>sum(jvm_memory_used_bytes{area=”heap”}) by (instance) / sum(jvm_memory_max_bytes{area=”heap”}) by (instance)</ul><li>활성 스레드 수<ul><li>jvm_threads_live_threads</ul><li>스프링 평균 gc 지연시간(초)<ul><li>avg(jvm_gc_pause_seconds_sum) by (instance)</ul></ul><li>참고<ul><li><a href="https://docs.spring.io/spring-boot/reference/actuator/metrics.html#actuator.metrics.supported" target="_blank">지원하는 메트릭 설명</a></ul></ul><h2 id="구조">구조</h2><ul><li>모니터링 대상에 exporter 설치<ul><li>docker container 내부에 spring과 node_exporter를 설치한다.<li>spring에 프로메테우스 메트릭 관련 의존성 패키지를 설치한다.</ul><li>프로메테우스 환경을 구축한다.<ul><li>프로메테우스 설정에서 모니터링 대상 관련 설정을 추가한다.</ul><li>얼럿매니저 환경을 구축한다.<ul><li>프로메테우스 메트릭을 조합해서 얼럿을 보내도록 설정한다.<li>얼럿이 발생하면 메신저(예시에서는 슬랙)</ul></ul><h2 id="노드-메트릭-설정">노드 메트릭 설정</h2><ul><li>설명<ul><li>os에서 node_exporter를 설치해야한다.<li>jdk 이미지 기반 Dockerfile 내에서 node_exporter를 설치 후 실행한다.</ul><li>도커파일<div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>FROM amazoncorretto:21-alpine3.20  
            
...   
            
# node_exporter 설치  
RUN curl -L -O https://github.com/prometheus/node_exporter/releases/download/v1.8.2/node_exporter-1.8.2.linux-amd64.tar.gz  
            
RUN tar xvfz node_exporter-*.*-amd64.tar.gz  
            
RUN rm node_exporter-*.*-amd64.tar.gz  
            
...  
            
# 스크립트 복사  
COPY ./docker/web-script.sh .  
            
RUN chmod +x /web-script.sh  
            
CMD ["/web-script.sh"]  
</pre></table></code></div></div><li>web-script.sh<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c">#!/bin/sh  </span>
            
<span class="c"># Run node_exporter  </span>
./node_exporter-<span class="k">*</span>.<span class="k">*</span><span class="nt">-amd64</span>/node_exporter <span class="nt">--web</span>.listen-address<span class="o">=</span>0.0.0.0:9100 <span class="nt">--log</span>.level<span class="o">=</span>info &amp;  
            
...  
</pre></table></code></div></div><li>확인<ul><li>도커 컨테이너를 올린다.<li>브라우저를 켜고 http://localhost:9100/metrics 확인<li>성공 시 응답 예시<div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre># HELP go_gc_duration_seconds A summary of the pause duration of garbage collection cycles.  
# TYPE go_gc_duration_seconds summary  
go_gc_duration_seconds{quantile="0"} 1.2345e-04  
go_gc_duration_seconds{quantile="0.25"} 1.2345e-04  
go_gc_duration_seconds{quantile="0.5"} 1.2345e-04  
go_gc_duration_seconds{quantile="0.75"} 1.2345e-04  
go_gc_duration_seconds{quantile="1"} 1.2345e-04  
go_gc_duration_seconds_sum 1.2345e-04  
go_gc_duration_seconds_count 9  
</pre></table></code></div></div></ul></ul><h2 id="스프링-프로메테우스-메트릭-설정">스프링 프로메테우스 메트릭 설정</h2><ul><li>가정<ul><li>스프링은 설치되어 있다고 가정한다.</ul><li>build.gradle.kts<div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nf">dependencies</span> <span class="p">{</span>  
    <span class="c1">// Actuator 기능 추가  </span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"org.springframework.boot:spring-boot-starter-actuator"</span><span class="p">)</span>   
    <span class="c1">// Prometheus 메트릭 등록  </span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"io.micrometer:micrometer-registry-prometheus"</span><span class="p">)</span>  
<span class="p">}</span>  
</pre></table></code></div></div><li>resources/application.properties<div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre># Prometheus  
management.endpoints.web.exposure.include: prometheus  
</pre></table></code></div></div><li>확인<ul><li>도커 컨테이너를 올려 스프링 웹서버를 실행시킨다.<li>브라우저를 켜고 http://localhost:8080/actuator/prometheus 확인<li>성공 시 응답 예시<div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre># HELP application_ready_time_seconds Time taken for the application to be ready to service requests  
# TYPE application_ready_time_seconds gauge  
application_ready_time_seconds{main_application_class="com.example.demo.DemoApplicationKt"} 123.456  
                
# HELP application_started_time_seconds Time taken to start the application  
# TYPE application_started_time_seconds gauge  
application_started_time_seconds{main_application_class="com.example.demo.DemoApplicationKt"} 123.123  
                
# HELP disk_free_bytes Usable space for path  
# TYPE disk_free_bytes gauge  
disk_free_bytes{path="/."} 1.23456789E12  
...  
</pre></table></code></div></div></ul></ul><h2 id="프로메테우스에서-메트릭-수집">프로메테우스에서 메트릭 수집</h2><ul><li>prometheus.yml<div class="language-yml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>  <span class="na">scrape_configs</span><span class="pi">:</span>  
    <span class="pi">-</span> <span class="na">job_name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">web'</span>  
      <span class="na">metrics_path</span><span class="pi">:</span> <span class="s1">'</span><span class="s">/actuator/prometheus'</span>  
      <span class="na">scheme</span><span class="pi">:</span> <span class="s1">'</span><span class="s">http'</span>  
      <span class="na">static_configs</span><span class="pi">:</span>  
        <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">web:8080'</span><span class="pi">]</span>  
              
    <span class="pi">-</span> <span class="na">job_name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">web-node_exporter'</span>  
      <span class="na">metrics_path</span><span class="pi">:</span> <span class="s1">'</span><span class="s">/metrics'</span>  
      <span class="na">scheme</span><span class="pi">:</span> <span class="s1">'</span><span class="s">http'</span>  
      <span class="na">static_configs</span><span class="pi">:</span>  
        <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">web:9100'</span><span class="pi">]</span>  
</pre></table></code></div></div><li>docker-compose.yml<div class="language-yml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>  <span class="na">prometheus</span><span class="pi">:</span>  
    <span class="na">image</span><span class="pi">:</span> <span class="s">prom/prometheus:latest</span>  
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">prometheus</span>  
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>  
    <span class="na">volumes</span><span class="pi">:</span>  
      <span class="pi">-</span> <span class="s2">"</span><span class="s">./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml"</span>  
    <span class="na">ports</span><span class="pi">:</span>  
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9090:9090"</span>  
    <span class="na">depends_on</span><span class="pi">:</span>  
      <span class="pi">-</span> <span class="s">web</span>  
    <span class="na">networks</span><span class="pi">:</span>  
      <span class="pi">-</span> <span class="s">app-network</span>  
</pre></table></code></div></div><li>확인<ul><li>스프링 도커 컨테이너와 프로메테우스 도커 컨테이너를 실행한다.<li>브라우저를 켜고 http://localhost:9090 접속<li>node_exporter 변수 입력<ul><li>검색창에 node_cpu_seconds_total 입력 후 “Execute” 버튼 클릭<li>성공 시 응답 예시<div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>node_cpu_seconds_total{cpu="0", instance="web:9100", job="web-node_exporter", mode="idle"} 1234.56  
node_cpu_seconds_total{cpu="0", instance="web:9100", job="web-node_exporter", mode="iowait"} 12.34  
node_cpu_seconds_total{cpu="0", instance="web:9100", job="web-node_exporter", mode="irq"} 0.12  
node_cpu_seconds_total{cpu="0", instance="web:9100", job="web-node_exporter", mode="nice"} 0.01  
node_cpu_seconds_total{cpu="0", instance="web:9100", job="web-node_exporter", mode="softirq"} 1.23  
node_cpu_seconds_total{cpu="0", instance="web:9100", job="web-node_exporter", mode="steal"} 0  
</pre></table></code></div></div></ul><li>spring_exporter 변수 입력<ul><li>검색창에 http_server_requests_seconds_count 입력 후 “Execute” 버튼 클릭<li>성공 시 응답 예시<div class="language-text highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>http_server_requests_seconds_count{error="none", exception="none", instance="web:8080", job="web", method="GET", outcome="SUCCESS", status="200", uri="/actuator/prometheus"} 12345  
http_server_requests_seconds_count{error="none", exception="none", instance="web:8080", job="web", method="GET", outcome="CLIENT_ERROR", status="404", uri="/**"} 6789  
</pre></table></code></div></div></ul></ul><li>프로메테우스 검색 사용 방법<ul><li>메트릭 이름으로 검색<ul><li>node_cpu_seconds_total</ul><li>Label로 필터링 해서 검색<ul><li>node_cpu_seconds_total{cpu=”0”, mode=”user”}</ul><li>집계(aggregation) 함수 사용<ul><li>sum(node_cpu_seconds_total{mode=”idle”})</ul></ul></ul><h2 id="그라파나에서-프로메테우스-메트릭-시각화">그라파나에서 프로메테우스 메트릭 시각화</h2><ul><li>설명<ul><li>프로메테우스에서 매번 검색하기도 어렵고 <br /> 검색 결과를 시각화하여 한 눈에 보고 싶을 경우<br /> 그라파나와 연동하여 시각화할 수 있다.</ul><li>docker-compose.yml<div class="language-yml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>  <span class="na">grafana</span><span class="pi">:</span>  
    <span class="na">image</span><span class="pi">:</span> <span class="s">grafana/grafana:latest</span>  
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">grafana</span>  
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>  
    <span class="na">ports</span><span class="pi">:</span>  
      <span class="pi">-</span> <span class="s2">"</span><span class="s">3000:3000"</span>  
    <span class="na">volumes</span><span class="pi">:</span>  
      <span class="pi">-</span> <span class="s">./storage/grafana:/var/lib/grafana</span>  
    <span class="na">depends_on</span><span class="pi">:</span>  
      <span class="pi">-</span> <span class="s">prometheus</span>  
    <span class="na">networks</span><span class="pi">:</span>  
      <span class="pi">-</span> <span class="s">app-network</span>  
</pre></table></code></div></div><li>확인<ul><li>스프링, 프로메테우스, 그라파나 도커 컨테이너를 실행한다.<li>브라우저를 켜고 http://localhost:3000 접속<li>그라파나 로그인 화면이 나오면 성공<li>초기 ID/Password 는 admin/admin 이다.</ul><li>프로메테우스 데이터 소스 생성<ul><li>(좌상단 로고 클릭) Connetions &gt; Data sources<li>검색창에서 Prometheus 검색 후 결과에서 Prometheus 클릭<li>Connetion에서 http://prometheus:9090 입력<ul><li>URL의 prometheus는 도커 서비스 명이다.</ul><li>save &amp; test 버튼 클릭</ul><li>대시보드 생성<ul><li>(좌상단 로고 클릭) Dashboards 클릭<li>(우상단) New 버튼 클릭, (드롭다운 메뉴에서) New dashboard 클릭<li><ul><li>Add visualization 버튼 클릭</ul><li>(Select data source)에서 prometheus 클릭(이름은 다를 수 있음)<li>(오른쪽 사이드메뉴 panel options에서) Title 입력<li>(하단 메뉴 A 항목에서) builder/code 중 code 선택<li>“Enter a PromQL Query” 에 내가 원하는 프로메테우스 식을 넣으면 된다.<ul><li>예를 들어 CPU 사용률<br /> sum(rate(node_cpu_seconds_total{mode!=”idle”}[5m])) by (instance)</ul><li>(하단 메뉴 A 항목에서) Run queries 클릭하여 그래프 확인<li>(우상단) Save dashboard 버튼 클릭<li>(Save dashboard 왼쪽 사이드 메뉴에서) Title 입력 후 Save 버튼 클릭</ul><li>대시보드에 판넬 추가<ul><li>(좌상단 로고 클릭) Dashboards 클릭<li>(상단) Add 버튼 클릭, (드롭다운 메뉴에서) Visualization 클릭<li>위의 대시보드 생성과 같은 과정을 진행하면 판넬이 추가된다.</ul><li>대시보드 판넬 삭제 및 수정<ul><li>판넬 위젯 우상단에 (세로로 … ) 클릭<li>(드롭다운 메뉴에서) 판넬 삭제하고 싶으면 Remove 클릭<li>(드롭다운 메뉴에서) 판넬 수정하고 싶으면 Edit 클릭</ul></ul><h2 id="alertmanager-알람-전송">alertmanager 알람 전송</h2><ul><li>설명<ul><li>프로메테우스 메트릭을 이용하여 조건 충족 시 알람을 전송하게 할 수 있다.<li>그라파나에도 알람이 존재하나<br /> 알람을 보내기 위해 무거운 그라파나를 항시 켜둬야 하는 문제와<br /> 그라파나 다운 시 알람이 동작하지 않는 문제가 발생할 수 있기에<br /> alertmanager를 선택하였다.</ul><li>alert_rules.yml<ul><li>설명<ul><li>구체적인 알림을 설정하는 부분이다.</ul><li>기본적인 구조<div class="language-yml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>  <span class="na">groups</span><span class="pi">:</span>  
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">그룹_이름</span>  
      <span class="na">rules</span><span class="pi">:</span>  
        <span class="pi">-</span> <span class="na">alert</span><span class="pi">:</span> <span class="s">알람_이름</span>  
          <span class="na">expr</span><span class="pi">:</span> <span class="s">경고를 발생시킬 조건 (PromQL)</span>  
          <span class="na">for</span><span class="pi">:</span> <span class="s">경고 지속 시간</span>  
          <span class="na">labels</span><span class="pi">:</span>  
            <span class="na">severity</span><span class="pi">:</span> <span class="s">경고 심각도</span>  
          <span class="na">annotations</span><span class="pi">:</span>  
            <span class="na">summary</span><span class="pi">:</span> <span class="s2">"</span><span class="s">요약</span><span class="nv"> </span><span class="s">메시지"</span>  
            <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">알람</span><span class="nv"> </span><span class="s">상세</span><span class="nv"> </span><span class="s">설명"</span>  
</pre></table></code></div></div><li>구체적 설명<ul><li>groups<ul><li>알람 규칙을 그룹으로 묶음</ul><li>rules<ul><li>이 그룹 안에서 설정할 개별 알람 목록<li>하나의 그룹 안에 여러 개의 알람 추가 가능</ul><li>alert: 알람_이름<ul><li>알람의 이름</ul><li>expr: 경고를 발생시킬 조건 (PromQL)<ul><li>PromQL로 알람 조건을 정의<li>예제: 메모리 사용률이 80%를 초과하면 경고<div class="language-yml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="na">expr</span><span class="pi">:</span> <span class="s">node_memory_Active_bytes / node_memory_MemTotal_bytes &gt; 0.8</span>  
</pre></table></code></div></div></ul><li>for: 경고 지속 시간<ul><li>경고 조건이 특정 시간 동안 지속될 경우 알람을 발생시킴<li>예제: 5분 동안 조건이 충족되면 알람 발생<ul><li>for: 5m</ul></ul><li>labels<ul><li>알람의 속성(라벨)을 지정<li>주로 severity(심각도)를 설정<li>예제: warning<div class="language-yml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="na">labels</span><span class="pi">:</span>  
  <span class="na">severity</span><span class="pi">:</span> <span class="s">warning</span>  
</pre></table></code></div></div></ul><li>annotations<ul><li>알람이 발생했을 때 추가 메시지를 설정<li>summary: 간단한 알람 설명<li>description: 상세한 알람 내용<li>summary와 description은 Go Template이다.<li>예제<div class="language-yml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="na">annotations</span><span class="pi">:</span>  
  <span class="na">summary</span><span class="pi">:</span> <span class="s2">"</span><span class="s">메모리</span><span class="nv"> </span><span class="s">사용량이</span><span class="nv"> </span><span class="s">높습니다!"</span>  
  <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Instance</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.instance</span><span class="nv"> </span><span class="s">}}의</span><span class="nv"> </span><span class="s">메모리</span><span class="nv"> </span><span class="s">사용률이</span><span class="nv"> </span><span class="s">80%를</span><span class="nv"> </span><span class="s">초과했습니다."</span>  
</pre></table></code></div></div></ul></ul></ul><li>prometheus.yml<div class="language-yml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="na">alerting</span><span class="pi">:</span>  
  <span class="na">alertmanagers</span><span class="pi">:</span>  
    <span class="pi">-</span> <span class="na">static_configs</span><span class="pi">:</span>  
        <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span>  
            <span class="pi">-</span> <span class="s1">'</span><span class="s">alertmanager:9093'</span>  <span class="c1"># Alertmanager의 주소  </span>
            
<span class="na">rule_files</span><span class="pi">:</span>  
  <span class="pi">-</span> <span class="s1">'</span><span class="s">/etc/prometheus/alert_rules.yml'</span>  <span class="c1"># 알림 규칙 파일  </span>
</pre></table></code></div></div><ul><li>프로메테우스에 alert_rules.yml을 등록한다.<li>얼럿매니저를 등록한다.<li>이때 alertmanger:9093 중 alertmanger은 도커 서비스 명이다.</ul><li>alertmanager.yml<ul><li>설명<ul><li>global - alertmanager의 전역 설정<li>route - 알람을 어떻게 라우팅할지 설정<li>receivers - 알림을 받을 대상 설정</ul><li>기본적 구조<div class="language-yml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>  <span class="na">global</span><span class="pi">:</span>  
    <span class="na">resolve_timeout</span><span class="pi">:</span> <span class="s">알람 해제 후 유지 시간</span>  
                  
  <span class="na">route</span><span class="pi">:</span>  
    <span class="na">group_by</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">알람 그룹 기준</span><span class="pi">]</span>  
    <span class="na">group_wait</span><span class="pi">:</span> <span class="s">최초 알람 대기 시간</span>  
    <span class="na">group_interval</span><span class="pi">:</span> <span class="s">그룹 내 추가 알람 무시 시간</span>  
    <span class="na">repeat_interval</span><span class="pi">:</span> <span class="s">같은 알람 반복 전송 시간</span>  
    <span class="na">receiver</span><span class="pi">:</span> <span class="s">기본 수신자</span>  
                  
  <span class="na">receivers</span><span class="pi">:</span>  
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">수신자_이름</span>  
      <span class="s">알람 전송 방식 설정</span>  
</pre></table></code></div></div><li>구체적 설명<ul><li>global<ul><li>algermanager 전역 설정<li>resolve_timeout<ul><li>알람이 해결된 후 해제 상태를 유지하는 시간<li>알람 조건이 충족되어 알람이 전송된 후<br /> 운영자가 조치하여 알람 조건이 해제되었다고 하자.<br /> 그 상태가 resolve_timeout 시간만큼 지나면 “해제됨” 상태가 된다.<br /> 헤제됨 상태가 되면 프로메테우스에서 해당 알람 상태가 inactive 된다.</ul></ul><li>route<ul><li>알람을 그룹화하고 전달하는 방식<li>group_by<ul><li>같은 그룹으로 묶을 라벨 지정<li>alert_rules.yml의 groups &gt; rules &gt; labels에 따라 <br /> group by 하게 된다.</ul><li>group_wait<ul><li>첫 번째 알람이 발생한 후 전송하기 전 대기 시간<li>처음 한 개의 알람이 발생하면 프로메테우스에서 <br /> “혹시 이거랑 같이 묶을 수 있는 다른 알람도 곧 생기지 않을까?” <br /> 하고 기다리는 시간</ul><li>group_interval<ul><li>같은 그룹 내에서 추가 알람 발생 시 추가 알람 무시 시간</ul><li>repeat_interval<ul><li>동일 알람이 반복될 경우 무시하는 시간</ul><li>receiver<ul><li>알람을 보낼 기본 수신자 설정<li>아래 receivers에서 설정한 name 중 하나를 입력한다.</ul></ul><li>receivers<ul><li>알람을 받을 대상 설정(Slcak, Email 등)<li>name: 수신자 이름<li>알람 전송 방식 설정: Slack, Email 등의 설정 추가<ul><li>슬랙 예시<div class="language-yml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>                  
<span class="na">receivers</span><span class="pi">:</span>  
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">slack-notifications'</span>  
    <span class="na">slack_configs</span><span class="pi">:</span>  
      <span class="pi">-</span> <span class="na">api_url</span><span class="pi">:</span> <span class="s1">'</span><span class="s">&lt;your</span><span class="nv"> </span><span class="s">slack-webhook</span><span class="nv"> </span><span class="s">URL&gt;'</span>  
        <span class="na">channel</span><span class="pi">:</span> <span class="s1">'</span><span class="s">#alarm'</span>  
        <span class="na">text</span><span class="pi">:</span> <span class="pi">&gt;</span>
          <span class="s">{{ range $i, .Alerts }}</span>
          <span class="s">{{ if ne $i 0 }}\n--\n{{ end }}</span>
          <span class="s">*Alert:* {{ .Annotations.summary }}\n</span>
          <span class="s">*Description:* {{ .Annotations.description }}\n</span>
          <span class="s">*View Alert:* &lt;http://localhost:9093/#/alerts?silenced=false&amp;inhibited=false&amp;active=true&amp;filter=%7Balertname%3D%22{{ .Labels.alertname }}%22%7D|Click here&gt;</span>
          <span class="s">{{ end }}</span>

          <span class="no">        </span>
</pre></table></code></div></div><li>api_url<ul><li>유효한 webhook 주소를 반드시 적어야 함<li><a href="https://help.ovice.com/hc/ko/articles/16515667939737--Webhook-%EC%84%A4%EC%A0%95-Slack%EC%97%90%EC%84%9C-%EC%95%8C%EB%A6%BC-%EB%B0%9B%EA%B8%B0" target="_blank">슬랙 웹훅 생성법</a><br /> (1~13번까지 따라하고 웹훅 URL 복사하여 api_url에 붙여넣기)</ul></ul></ul></ul></ul><li>docker-compose.yml<div class="language-yml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre>  <span class="na">prometheus</span><span class="pi">:</span>  
    <span class="na">image</span><span class="pi">:</span> <span class="s">prom/prometheus:latest</span>  
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">prometheus</span>  
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>  
    <span class="na">volumes</span><span class="pi">:</span>  
      <span class="pi">-</span> <span class="s2">"</span><span class="s">./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml"</span>  
      <span class="c1"># !-- 추가 시작 --! #  </span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">./prometheus/alert_rules.yml:/etc/prometheus/alert_rules.yml"</span>  
      <span class="c1"># !-- 추가 끝 --! #  </span>
    <span class="na">ports</span><span class="pi">:</span>  
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9090:9090"</span>  
    <span class="na">depends_on</span><span class="pi">:</span>  
      <span class="pi">-</span> <span class="s">web</span>  
    <span class="na">networks</span><span class="pi">:</span>  
      <span class="pi">-</span> <span class="s">app-network</span>  
            
  <span class="na">alertmanager</span><span class="pi">:</span>  
    <span class="na">image</span><span class="pi">:</span> <span class="s">prom/alertmanager:latest</span>  
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">alertmanager</span>  
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>  
    <span class="na">ports</span><span class="pi">:</span>  
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9093:9093"</span>  
    <span class="na">volumes</span><span class="pi">:</span>  
      <span class="pi">-</span> <span class="s2">"</span><span class="s">./prometheus/alertmanager.yml:/etc/alertmanager/config.yml"</span>  
    <span class="na">command</span><span class="pi">:</span>  
      <span class="pi">-</span> <span class="s1">'</span><span class="s">--config.file=/etc/alertmanager/config.yml'</span>  
    <span class="na">depends_on</span><span class="pi">:</span>  
      <span class="pi">-</span> <span class="s">prometheus</span>  
    <span class="na">networks</span><span class="pi">:</span>  
      <span class="pi">-</span> <span class="s">app-network</span>  
</pre></table></code></div></div><li>확인<ul><li>스프링, 프로메테우스, 얼럿매니저 도커 컨테이너를 실행한다.<li>프로메테우스 알람 룰이 잘 등록되었는지 확인<ul><li>브라우저를 켜고 http://localhost:9090/alerts로 접속<li>alert_rules.yml에 등록한 알람이 잘 등록되었는지 확인</ul><li>얼럿매니저 잘 동작하는지 확인<ul><li>브라우저를 켜고 http://localhost:9093 접속<li>정상 접속되면 성공<li>알람이 발송되면 slack과 얼럿매니저에서 기록되어야 함</ul></ul><li>알람 일부러 일으켜 보기<ul><li>alert_rules.yml<div class="language-yml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>      
<span class="na">groups</span><span class="pi">:</span>  
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">CPU</span>  
    <span class="na">rules</span><span class="pi">:</span>  
      <span class="pi">-</span> <span class="na">alert</span><span class="pi">:</span> <span class="s">HighCPUUsage</span>  
<span class="c1">#        expr: (sum(rate(node_cpu_seconds_total{mode!="idle"}[5m])) by (instance)) &gt; 0.7  </span>
<span class="c1">#        for: 30s  </span>
        <span class="na">expr</span><span class="pi">:</span> <span class="s">(sum(rate(node_cpu_seconds_total{mode!="idle"}[5m])) by (instance)) &gt; 0.00001</span>  
        <span class="na">for</span><span class="pi">:</span> <span class="s">1s</span>  
        <span class="na">labels</span><span class="pi">:</span>  
          <span class="na">severity</span><span class="pi">:</span> <span class="s">critical</span>  
        <span class="na">annotations</span><span class="pi">:</span>  
          <span class="na">summary</span><span class="pi">:</span> <span class="s2">"</span><span class="s">CPU</span><span class="nv"> </span><span class="s">사용량</span><span class="nv"> </span><span class="s">70%</span><span class="nv"> </span><span class="s">초과</span><span class="nv"> </span><span class="s">지속"</span>  
          <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Instance</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$labels.instance</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">has</span><span class="nv"> </span><span class="s">high</span><span class="nv"> </span><span class="s">CPU</span><span class="nv"> </span><span class="s">usage."</span>
        
</pre></table></code></div></div><li>위 설정을 적용하고 일정 시간 기다림<li>이후 slack이나 얼럿매니저를 확인하면 알람 확인 가능</ul></ul><h2 id="예시-github-repository">예시 github repository</h2><ul><li><a href="https://github.com/a3magic3pocket/monitoring-sandbox" target="_blank">monitoring-sandbox</a></ul><h2 id="참고">참고</h2><ul><li><a href="https://help.ovice.com/hc/ko/articles/16515667939737--Webhook-%EC%84%A4%EC%A0%95-Slack%EC%97%90%EC%84%9C-%EC%95%8C%EB%A6%BC-%EB%B0%9B%EA%B8%B0" target="_blank">슬랙 웹훅 생성</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/monitoring/'>Monitoring</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/prometheus/" class="post-tag no-text-decoration" >prometheus</a> <a href="/tags/grafana/" class="post-tag no-text-decoration" >grafana</a> <a href="/tags/alertmanager/" class="post-tag no-text-decoration" >alertmanager</a> <a href="/tags/essay/" class="post-tag no-text-decoration" >essay</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=메트릭 모니터링(prometheus, grafana, alertmanager) - 의사줌치&url=https://a3magic3pocket.github.io/posts/metrics-monitoring-with-prometheus-grafana-and-alertmanager/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=메트릭 모니터링(prometheus, grafana, alertmanager) - 의사줌치&u=https://a3magic3pocket.github.io/posts/metrics-monitoring-with-prometheus-grafana-and-alertmanager/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=메트릭 모니터링(prometheus, grafana, alertmanager) - 의사줌치&url=https://a3magic3pocket.github.io/posts/metrics-monitoring-with-prometheus-grafana-and-alertmanager/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/kafka-large-scale-event-processing-architecture-and-performance-comparison/">Kafka를 활용한 대용량 이벤트 처리 구조 설계와 성능 비교</a><li><a href="/posts/experimenting-with-blue-green-deployments/">블루 - 그린 배포 실험</a><li><a href="/posts/spring-kafka-latest-message-pub-sub-config/">Spring Kafka에서 최신 메시지만 소비하는 Pub/Sub 방식 설정</a><li><a href="/posts/solving-concurrency-problems-with-performance-in-mind/">동시성 문제 해결 방안 성능 실험</a><li><a href="/posts/exploring-authentication-options/">인증방식 고민</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/kafka/">kafka</a> <a class="post-tag" href="/tags/kotlin/">kotlin</a> <a class="post-tag" href="/tags/elasticsearch/">elasticsearch</a> <a class="post-tag" href="/tags/elk/">elk</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/summary/">summary</a> <a class="post-tag" href="/tags/git/">git</a> <a class="post-tag" href="/tags/kafka-streams/">kafka-streams</a> <a class="post-tag" href="/tags/nest/">nest</a> <a class="post-tag" href="/tags/react/">react</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/experimenting-with-blue-green-deployments/"><div class="card-body"> <span class="timeago small" > Apr 6 <i class="unloaded">2025-04-06T08:47:25+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>블루 - 그린 배포 실험</h3><div class="text-muted small"><p> 블루 - 그린 배포란? 두 개의 동일한 환경(블루와 그린)을 유지하며, 새 버전을 배포한 후 트래픽을 전환하여 새로운 버전을 운영에 적용 왜 하는가? 새로운 애플리케이션 버전을 배포하면서 서비스 중단 없이 안전하게 전환하기 위해서 작동 방식 블루 환경에서 운영 중 기존 애플리케이션(블루)이 사용자의 모든 트...</p></div></div></a></div><div class="card"> <a href="/posts/solving-concurrency-problems-with-performance-in-mind/"><div class="card-body"> <span class="timeago small" > Apr 6 <i class="unloaded">2025-04-06T08:48:05+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>동시성 문제 해결 방안 성능 실험</h3><div class="text-muted small"><p> 동시성 문제란? 여러 프로세스나 스레드가 동시에 실행되는 상황에서 자원(데이터 등)을 제대로 공유하거나 수정하지 못해 발생하는 문제 구체적인 상황 id, numLikes 필드로 이뤄진 POST 테이블이 있다. likePost 함수는 postId를 인자로 받고, post을 조회한 뒤 기존 numLikes를 읽고 그 값에 +1을 한 ...</p></div></div></a></div><div class="card"> <a href="/posts/exploring-authentication-options/"><div class="card-body"> <span class="timeago small" > Apr 6 <i class="unloaded">2025-04-06T08:49:12+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>인증방식 고민</h3><div class="text-muted small"><p> 세션 인증 방식과 JWT 인증 방식의 차이 세션 방식 서버에서 사용자 정보를 key-value 저장소에 저장 서버에서 key를 사용자 쿠키에 담아서 전송 사용자가 인증이 필요한 요청을 하면 요청과 함께 키가 담긴 쿠키가 서버로 전송됨 서버는 key를 가지고 key-value 저장소를 조회하여 인...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/exploring-authentication-options/" class="btn btn-outline-primary" prompt="Older"><p>인증방식 고민</p></a> <a href="/posts/kafka-large-scale-event-processing-architecture-and-performance-comparison/" class="btn btn-outline-primary" prompt="Newer"><p>Kafka를 활용한 대용량 이벤트 처리 구조 설계와 성능 비교</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/a3magic3pocket">의사줌치</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/kafka/">kafka</a> <a class="post-tag" href="/tags/kotlin/">kotlin</a> <a class="post-tag" href="/tags/elasticsearch/">elasticsearch</a> <a class="post-tag" href="/tags/elk/">elk</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/summary/">summary</a> <a class="post-tag" href="/tags/git/">git</a> <a class="post-tag" href="/tags/kafka-streams/">kafka streams</a> <a class="post-tag" href="/tags/nest/">nest</a> <a class="post-tag" href="/tags/react/">react</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://a3magic3pocket.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
