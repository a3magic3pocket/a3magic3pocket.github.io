<!DOCTYPE html><html lang="ko-KR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="카프카 커넥트(kafka connect), json 스키마 사용하기" /><meta property="og:locale" content="ko_KR" /><meta name="description" content="개요 카프카 스트림(kafka streams) 데이터를 mongoDB로 보낼때 타입을 명시하고 싶을 때가 있다. 이때 json 스키마를 사용할 수 있다. 정해진 포맷에 맞춰 작성 후 데이터를 담아 보내면 mongodb가 데이터를 지정된 타입으로 인식하고 저장한다. json 스키마는 매번 스키마를 같이 보내야하기 때문에 전송되는 데이터 크기가 그냥 json만 보냈을 때보다 크다. 이때는 스키마 레지스트리(schema registry)를 사용하여 스키마를 저장하고, mongoDB에서 이를 참조할 수 있게 하면 크기를 줄일 수 있다. 본 문에서는 json 스키마 사용법만을 기록한다." /><meta property="og:description" content="개요 카프카 스트림(kafka streams) 데이터를 mongoDB로 보낼때 타입을 명시하고 싶을 때가 있다. 이때 json 스키마를 사용할 수 있다. 정해진 포맷에 맞춰 작성 후 데이터를 담아 보내면 mongodb가 데이터를 지정된 타입으로 인식하고 저장한다. json 스키마는 매번 스키마를 같이 보내야하기 때문에 전송되는 데이터 크기가 그냥 json만 보냈을 때보다 크다. 이때는 스키마 레지스트리(schema registry)를 사용하여 스키마를 저장하고, mongoDB에서 이를 참조할 수 있게 하면 크기를 줄일 수 있다. 본 문에서는 json 스키마 사용법만을 기록한다." /><link rel="canonical" href="https://a3magic3pocket.github.io/posts/kafka-connect-json-schema/" /><meta property="og:url" content="https://a3magic3pocket.github.io/posts/kafka-connect-json-schema/" /><meta property="og:site_name" content="의사줌치" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-04-05T11:36:01+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="카프카 커넥트(kafka connect), json 스키마 사용하기" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"개요 카프카 스트림(kafka streams) 데이터를 mongoDB로 보낼때 타입을 명시하고 싶을 때가 있다. 이때 json 스키마를 사용할 수 있다. 정해진 포맷에 맞춰 작성 후 데이터를 담아 보내면 mongodb가 데이터를 지정된 타입으로 인식하고 저장한다. json 스키마는 매번 스키마를 같이 보내야하기 때문에 전송되는 데이터 크기가 그냥 json만 보냈을 때보다 크다. 이때는 스키마 레지스트리(schema registry)를 사용하여 스키마를 저장하고, mongoDB에서 이를 참조할 수 있게 하면 크기를 줄일 수 있다. 본 문에서는 json 스키마 사용법만을 기록한다.","url":"https://a3magic3pocket.github.io/posts/kafka-connect-json-schema/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://a3magic3pocket.github.io/posts/kafka-connect-json-schema/"},"headline":"카프카 커넥트(kafka connect), json 스키마 사용하기","dateModified":"2024-04-05T11:47:16+09:00","datePublished":"2024-04-05T11:36:01+09:00","@context":"https://schema.org"}</script><title>카프카 커넥트(kafka connect), json 스키마 사용하기 | 의사줌치</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="의사줌치"><meta name="application-name" content="의사줌치"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-5NQ41XXW83"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-5NQ41XXW83'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/sample/avatar-crop.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">의사줌치</a></div><div class="site-subtitle font-italic">부정확한 정보를 <br /> 담고 있을 수 있습니다.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/a3magic3pocket" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['a3magic3pocket','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>카프카 커넥트(kafka connect), json 스키마 사용하기</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>카프카 커넥트(kafka connect), json 스키마 사용하기</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> 의사줌치 </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Apr 5, 2024, 11:36 AM +0900" prep="on" > Apr 5, 2024 <i class="unloaded">2024-04-05T11:36:01+09:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Fri, Apr 5, 2024, 11:47 AM +0900" prefix="Updated " > Apr 5, 2024 <i class="unloaded">2024-04-05T11:47:16+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1152 words">6 min</span></div></div><div class="post-content"><h2 id="개요">개요</h2><ul><li>카프카 스트림(kafka streams) 데이터를 mongoDB로 보낼때<br /> 타입을 명시하고 싶을 때가 있다.<li>이때 json 스키마를 사용할 수 있다.<li>정해진 포맷에 맞춰 작성 후 데이터를 담아 보내면<br /> mongodb가 데이터를 지정된 타입으로 인식하고 저장한다.<li>json 스키마는 매번 스키마를 같이 보내야하기 때문에<br /> 전송되는 데이터 크기가 그냥 json만 보냈을 때보다 크다.<li>이때는 스키마 레지스트리(schema registry)를 <br /> 사용하여 스키마를 저장하고, <br /> mongoDB에서 이를 참조할 수 있게 하면 크기를 줄일 수 있다.<li>본 문에서는 json 스키마 사용법만을 기록한다.</ul><h2 id="예시">예시</h2><ul><li>보내고자 하는 데이터<ul><li>id 컬럼명<ul><li>타입: string<li>데이터: my-id</ul><li>name 컬럼명<ul><li>타입: string<li>데이터: 민수</ul><li>age 컬럼명<ul><li>타입: int32<li>데이터: 17</ul></ul><li>json 스키마<ul><li>설명<ul><li>크게 schema와 payload 컬럼로 이뤄진다.<li>schema는 스키마가 담기는 구간으로<br /> type, optional, field와 같은 데이터가 저장된다.<li>payload는 원본 json 데이터가 저장된다.<li>[<a href="https://www.confluent.io/ko-kr/blog/kafka-connect-deep-dive-converters-serialization-explained/" target="_blank">참고1</a>][<a href="https://cwiki.apache.org/confluence/display/KAFKA/KIP-301%3A+Schema+Inferencing+for+JsonConverter" target="_blank">참고2</a>]</ul><li>json 스키마 데이터<div class="language-json highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">  
  </span><span class="nl">"schema"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"struct"</span><span class="p">,</span><span class="w">  
    </span><span class="nl">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">  
      </span><span class="p">{</span><span class="w">  
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">  
        </span><span class="nl">"optional"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">  
        </span><span class="nl">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"id"</span><span class="w">  
      </span><span class="p">},</span><span class="w">  
      </span><span class="p">{</span><span class="w">  
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">  
        </span><span class="nl">"optional"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">  
        </span><span class="nl">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="w">  
      </span><span class="p">},</span><span class="w">  
      </span><span class="p">{</span><span class="w">  
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"int32"</span><span class="p">,</span><span class="w">  
        </span><span class="nl">"optional"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">  
        </span><span class="nl">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"age"</span><span class="w">  
      </span><span class="p">}</span><span class="w">  
    </span><span class="p">],</span><span class="w">  
    </span><span class="nl">"optional"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">  
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my-database.my-collection"</span><span class="w">  
  </span><span class="p">},</span><span class="w">  
  </span><span class="nl">"payload"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my-id"</span><span class="p">,</span><span class="w">  
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"민수"</span><span class="p">,</span><span class="w">  
    </span><span class="nl">"age"</span><span class="p">:</span><span class="w"> </span><span class="mi">17</span><span class="w">  
  </span><span class="p">}</span><span class="w">  
</span><span class="p">}</span><span class="w">  
</span></pre></table></code></div></div></ul></ul><h2 id="카프카-카프카-스트림-카프카-커넥트-설정">카프카, 카프카 스트림, 카프카 커넥트 설정</h2><ul><li>기본적으로 아래 링크와 동일한 설정이며<br /> 앞으로의 내용은 변경된 부분을 주로 서술한다.<li><a href="https://a3magic3pocket.github.io/posts/write-kafka-stream-to-mongodb-using-kafka-connect/#%EC%B9%B4%ED%94%84%EC%B9%B4-%EC%84%A4%EC%A0%95" target="_blank">카프카 커넥트(kafka connect)로 mongoDB에 카프카 스트림 쓰기</a></ul><h2 id="카프카-스트림-설정">카프카 스트림 설정</h2><ul><li>개요<ul><li>json 스키마 사용 시, aggregation 후에 Serde를 설정할때<br /> deserializer로 JsonSchemaSerde를 설정해야 한다.<li>JsonSchema.schema.name으로 materialized view가 저장되에<br /> 기존에 Materialized.as(‘뷰 이름’) 부분은 생략한다.</ul><li>환경<ul><li>java 21<li>spring boot 3.2.3</ul><li>설치<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>implementation <span class="s1">'org.apache.kafka:kafka-streams'</span>  
implementation <span class="s1">'org.springframework.kafka:spring-kafka'</span>  
</pre></table></code></div></div><li>user/User.java<div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nd">@Setter</span>  
<span class="nd">@Getter</span>  
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>  
    <span class="kd">public</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>  
    <span class="kd">public</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>  
    <span class="kd">public</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>  
<span class="o">}</span>  
</pre></table></code></div></div><li>user/UserSerde.java<div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">org.apache.kafka.common.serialization.Serdes.WrapperSerde</span><span class="o">;</span>  
<span class="kn">import</span> <span class="nn">org.springframework.kafka.support.serializer.JsonDeserializer</span><span class="o">;</span>  
<span class="kn">import</span> <span class="nn">org.springframework.kafka.support.serializer.JsonSerializer</span><span class="o">;</span>  
            
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserSerde</span> <span class="kd">extends</span> <span class="nc">WrapperSerde</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="o">{</span>  
    <span class="kd">public</span> <span class="nf">UserSerde</span><span class="o">()</span> <span class="o">{</span>  
        <span class="kd">super</span><span class="o">(</span><span class="k">new</span> <span class="nc">JsonSerializer</span><span class="o">&lt;&gt;(),</span> <span class="k">new</span> <span class="nc">JsonDeserializer</span><span class="o">&lt;&gt;(</span><span class="nc">User</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>  
    <span class="o">}</span>  
<span class="o">}</span>  
</pre></table></code></div></div><li>streams/JsonSchema.java<div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nd">@Setter</span>  
<span class="nd">@Getter</span>  
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JsonSchema</span> <span class="o">{</span>  
	<span class="kd">public</span> <span class="nc">SchemaDto</span> <span class="n">schema</span><span class="o">;</span>  
	<span class="kd">public</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">payload</span><span class="o">;</span>  
<span class="o">}</span>  
</pre></table></code></div></div><li>streams/SchemaDto.java<div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nd">@Getter</span>  
<span class="nd">@Setter</span>  
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SchemaDto</span> <span class="o">{</span>  
	<span class="kd">public</span> <span class="nc">String</span> <span class="n">type</span><span class="o">;</span>  
	<span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">FieldsDto</span><span class="o">&gt;</span> <span class="n">fields</span><span class="o">;</span>  
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="n">optional</span><span class="o">;</span>  
	<span class="kd">public</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>  
<span class="o">}</span>  
</pre></table></code></div></div><li>streams/FieldsDto.java<div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nd">@Getter</span>  
<span class="nd">@Setter</span>  
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FieldsDto</span> <span class="o">{</span>  
	<span class="kd">public</span> <span class="nc">String</span> <span class="n">type</span><span class="o">;</span>  
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="n">optional</span><span class="o">;</span>  
	<span class="kd">public</span> <span class="nc">String</span> <span class="n">field</span><span class="o">;</span>  
<span class="o">}</span>  
</pre></table></code></div></div><li>streams/JsonSchemaSerde.java<div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">org.apache.kafka.common.serialization.Serdes.WrapperSerde</span><span class="o">;</span>  
<span class="kn">import</span> <span class="nn">org.springframework.kafka.support.serializer.JsonDeserializer</span><span class="o">;</span>  
<span class="kn">import</span> <span class="nn">org.springframework.kafka.support.serializer.JsonSerializer</span><span class="o">;</span>  
            
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JsonSchemaSerde</span> <span class="kd">extends</span> <span class="nc">WrapperSerde</span><span class="o">&lt;</span><span class="nc">JsonSchema</span><span class="o">&gt;</span> <span class="o">{</span>  
	<span class="kd">public</span> <span class="nf">JsonSchemaSerde</span><span class="o">()</span> <span class="o">{</span>  
		<span class="kd">super</span><span class="o">(</span><span class="k">new</span> <span class="nc">JsonSerializer</span><span class="o">&lt;&gt;(),</span> <span class="k">new</span> <span class="nc">JsonDeserializer</span><span class="o">&lt;&gt;(</span><span class="nc">JsonSchema</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>  
	<span class="o">}</span>  
<span class="o">}</span>  
            
</pre></table></code></div></div><li>streams/JsonSchemaService.java<div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JsonSchemaService</span> <span class="o">{</span>  
    <span class="kd">public</span> <span class="nc">JsonSchema</span> <span class="nf">getDefaultJsonSchema</span><span class="o">(</span><span class="nc">String</span> <span class="n">schemaName</span><span class="o">,</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">fields</span><span class="o">)</span> <span class="o">{</span>  
        <span class="nc">JsonSchema</span> <span class="n">newJsonSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JsonSchema</span><span class="o">();</span>  
            
        <span class="nc">SchemaDto</span> <span class="n">schemaDto</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SchemaDto</span><span class="o">();</span>  
            
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">FieldsDto</span><span class="o">&gt;</span> <span class="n">fieldsDtos</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">FieldsDto</span><span class="o">&gt;();</span>  
        <span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">fieldName</span> <span class="o">:</span> <span class="n">fields</span><span class="o">.</span><span class="na">keySet</span><span class="o">())</span> <span class="o">{</span>  
            <span class="nc">FieldsDto</span> <span class="n">fieldsDto</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FieldsDto</span><span class="o">();</span>  
            <span class="n">fieldsDto</span><span class="o">.</span><span class="na">setField</span><span class="o">(</span><span class="n">fieldName</span><span class="o">);</span>  
            <span class="n">fieldsDto</span><span class="o">.</span><span class="na">setType</span><span class="o">(</span><span class="n">fields</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">fieldName</span><span class="o">));</span>  
            <span class="n">fieldsDto</span><span class="o">.</span><span class="na">setOptional</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>  
            <span class="n">fieldsDtos</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">fieldsDto</span><span class="o">);</span>  
        <span class="o">}</span>  
            
        <span class="c1">// schema name is like "database.collection"  </span>
        <span class="n">schemaDto</span><span class="o">.</span><span class="na">setType</span><span class="o">(</span><span class="s">"struct"</span><span class="o">);</span>  
        <span class="n">schemaDto</span><span class="o">.</span><span class="na">setFields</span><span class="o">(</span><span class="n">fieldsDtos</span><span class="o">);</span>  
        <span class="n">schemaDto</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">schemaName</span><span class="o">);</span>  
        <span class="n">schemaDto</span><span class="o">.</span><span class="na">setOptional</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>  
            
        <span class="n">newJsonSchema</span><span class="o">.</span><span class="na">setSchema</span><span class="o">(</span><span class="n">schemaDto</span><span class="o">);</span>  
            
        <span class="k">return</span> <span class="n">newJsonSchema</span><span class="o">;</span>  
    <span class="o">}</span>  
<span class="o">}</span>  
</pre></table></code></div></div><li>global/config/KafkaStreamsConfig.java<div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
</pre><td class="rouge-code"><pre><span class="nd">@Configuration</span>  
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">KafkaStreamsConfig</span> <span class="o">{</span>  
            
    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${spring.kafka.producer.bootstrap-servers}"</span><span class="o">)</span>  
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">bootstrapServers</span><span class="o">;</span>  
            
    <span class="nc">KafkaStreamsConfiguration</span> <span class="nf">kStreamsConfig</span><span class="o">(</span><span class="nc">String</span> <span class="n">applicationId</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">valueSerde</span><span class="o">)</span> <span class="o">{</span>  
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">props</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>  
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">StreamsConfig</span><span class="o">.</span><span class="na">APPLICATION_ID_CONFIG</span><span class="o">,</span> <span class="n">applicationId</span><span class="o">);</span>  
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">StreamsConfig</span><span class="o">.</span><span class="na">BOOTSTRAP_SERVERS_CONFIG</span><span class="o">,</span> <span class="n">bootstrapServers</span><span class="o">);</span>  
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">StreamsConfig</span><span class="o">.</span><span class="na">DEFAULT_KEY_SERDE_CLASS_CONFIG</span><span class="o">,</span> <span class="nc">Serdes</span><span class="o">.</span><span class="na">String</span><span class="o">().</span><span class="na">getClass</span><span class="o">());</span>  
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">StreamsConfig</span><span class="o">.</span><span class="na">DEFAULT_VALUE_SERDE_CLASS_CONFIG</span><span class="o">,</span> <span class="n">valueSerde</span><span class="o">);</span>  
            
        <span class="k">return</span> <span class="k">new</span> <span class="nf">KafkaStreamsConfiguration</span><span class="o">(</span><span class="n">props</span><span class="o">);</span>  
    <span class="o">}</span>  
            
    <span class="nd">@Bean</span><span class="o">(</span><span class="s">"userDSLBuilder"</span><span class="o">)</span>  
    <span class="nc">FactoryBean</span><span class="o">&lt;</span><span class="nc">StreamsBuilder</span><span class="o">&gt;</span> <span class="nf">userDSLBuilder</span><span class="o">()</span> <span class="o">{</span>  
        <span class="nc">StreamsBuilderFactoryBean</span> <span class="n">streamsBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StreamsBuilderFactoryBean</span><span class="o">(</span>  
                <span class="n">kStreamsConfig</span><span class="o">(</span><span class="s">"user"</span><span class="o">,</span> <span class="nc">UserSerde</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>  
        <span class="k">return</span> <span class="n">streamsBuilder</span><span class="o">;</span>  
    <span class="o">}</span>  
                
            
    <span class="nd">@Bean</span><span class="o">(</span><span class="s">"userKStream"</span><span class="o">)</span>  
    <span class="nc">KStream</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">User</span><span class="o">&gt;</span> <span class="nf">userKStream</span><span class="o">(</span><span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"userDSLBuilder"</span><span class="o">)</span> <span class="nc">StreamsBuilder</span> <span class="n">userDSLBuilder</span><span class="o">)</span> <span class="o">{</span>  
        <span class="nc">KStream</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">User</span><span class="o">&gt;</span> <span class="n">kStream</span> <span class="o">=</span> <span class="n">userDSLBuilder</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="s">"user"</span><span class="o">);</span>  
            
        <span class="c1">// @formatter:off  </span>
        <span class="n">kStream</span>  
            <span class="o">.</span><span class="na">selectKey</span><span class="o">((</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>  
                <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">replace</span><span class="o">(</span><span class="s">"\""</span><span class="o">,</span> <span class="s">""</span><span class="o">);</span>  
            <span class="o">})</span>  
            <span class="o">.</span><span class="na">groupByKey</span><span class="o">()</span>  
            <span class="o">.</span><span class="na">aggregate</span><span class="o">(</span>  
                <span class="k">new</span> <span class="nc">Initializer</span><span class="o">&lt;</span><span class="nc">JsonSchema</span><span class="o">&gt;()</span> <span class="o">{</span>  
                    <span class="kd">public</span> <span class="nc">JsonSchema</span> <span class="nf">apply</span><span class="o">()</span> <span class="o">{</span>  
                        <span class="k">return</span> <span class="k">new</span> <span class="nf">JsonSchema</span><span class="o">();</span>  
                    <span class="o">}</span>  
                <span class="o">},</span>  
                <span class="k">new</span> <span class="nc">Aggregator</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">User</span><span class="o">,</span> <span class="nc">JsonSchema</span><span class="o">&gt;()</span> <span class="o">{</span>  
                    <span class="kd">public</span> <span class="nc">JsonSchema</span> <span class="nf">apply</span><span class="o">(</span><span class="nc">String</span> <span class="n">key</span><span class="o">,</span> <span class="nc">User</span> <span class="n">value</span><span class="o">,</span> <span class="nc">JsonSchema</span> <span class="n">aggregate</span><span class="o">)</span> <span class="o">{</span>  
                        <span class="nc">JsonSchema</span> <span class="n">jsonSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JsonSchema</span><span class="o">();</span>  
                        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">fields</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;();</span>  
                        <span class="n">fields</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"string"</span><span class="o">);</span>  
                        <span class="n">fields</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"string"</span><span class="o">);</span>  
                        <span class="n">fields</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"age"</span><span class="o">,</span> <span class="s">"int32"</span><span class="o">);</span>  
                                    
                        <span class="nc">String</span> <span class="n">schemaName</span> <span class="o">=</span> <span class="s">"my-database.user"</span><span class="o">;</span>  
                        <span class="nc">JsonSchemaService</span> <span class="n">jsonSchemaService</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JsonSchemaService</span><span class="o">();</span>  
                                    
                        <span class="nc">JsonSchema</span> <span class="n">userJsonSchema</span> <span class="o">=</span> <span class="n">jsonSchemaService</span><span class="o">.</span><span class="na">getDefaultJsonSchema</span><span class="o">(</span><span class="n">schemaName</span><span class="o">,</span> <span class="n">fields</span><span class="o">);</span>  
                                    
                        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">payload</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;();</span>  
                        <span class="n">payload</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span><span class="n">value</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>  
                        <span class="n">payload</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>  
                        <span class="n">payload</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"age"</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">getAge</span><span class="o">());</span>  
                        <span class="n">userJsonSchema</span><span class="o">.</span><span class="na">setPayload</span><span class="o">(</span><span class="n">payload</span><span class="o">);</span>  
                                    
                        <span class="n">aggregate</span> <span class="o">=</span> <span class="n">userJsonSchema</span><span class="o">;</span>  
                                    
                        <span class="k">return</span> <span class="n">aggregate</span><span class="o">;</span>  
                    <span class="o">}</span>  
                <span class="o">},</span>  
                <span class="nc">Materialized</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="nc">Serdes</span><span class="o">.</span><span class="na">String</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">JsonSchemaSerde</span><span class="o">())</span>  
                <span class="c1">// Materialized.as("User")  </span>
            <span class="o">)</span>  
        <span class="o">.</span><span class="na">toStream</span><span class="o">()</span>  
        <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"user-result"</span><span class="o">);</span>  
        <span class="k">return</span> <span class="n">kStream</span><span class="o">;</span>  
    <span class="o">}</span>  
<span class="o">}</span>  
</pre></table></code></div></div></ul><h2 id="카프카-커넥트-설정">카프카 커넥트 설정</h2><ul><li>개요<ul><li>json schema를 사용하는 옵션을 설정한다.<div class="language-json highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">  
    </span><span class="nl">"value.converter"</span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apache.kafka.connect.json.JsonConverter"</span><span class="p">,</span><span class="w">   
    </span><span class="nl">"value.converter.schemas.enable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">  
</span><span class="p">}</span><span class="w">  
</span></pre></table></code></div></div></ul><li>생성 명령<div class="language-json highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">  
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mongo-sink-user"</span><span class="p">,</span><span class="w">  
    </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  
        </span><span class="nl">"connector.class"</span><span class="p">:</span><span class="w"> </span><span class="s2">"com.mongodb.kafka.connect.MongoSinkConnector"</span><span class="p">,</span><span class="w">  
        </span><span class="nl">"connection.uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mongodbuser://mongodbpw:mongopw@mongo:27017/"</span><span class="p">,</span><span class="w">  
        </span><span class="nl">"tasks.max"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w">  
        </span><span class="nl">"topics"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user-result"</span><span class="p">,</span><span class="w">  
        </span><span class="nl">"database"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my-database"</span><span class="p">,</span><span class="w">  
        </span><span class="nl">"collection"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user"</span><span class="p">,</span><span class="w">  
        </span><span class="nl">"key.converter"</span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apache.kafka.connect.storage.StringConverter"</span><span class="p">,</span><span class="w">  
        </span><span class="nl">"value.converter"</span><span class="p">:</span><span class="w"> </span><span class="s2">"org.apache.kafka.connect.json.JsonConverter"</span><span class="p">,</span><span class="w">  
        </span><span class="nl">"key.converter.schemas.enable"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">  
        </span><span class="nl">"value.converter.schemas.enable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">  
        </span><span class="nl">"document.id.strategy.overwrite.existing"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">  
        </span><span class="nl">"document.id.strategy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"com.mongodb.kafka.connect.sink.processor.id.strategy.PartialValueStrategy"</span><span class="p">,</span><span class="w">  
        </span><span class="nl">"document.id.strategy.partial.value.projection.list"</span><span class="p">:</span><span class="w"> </span><span class="s2">"id"</span><span class="p">,</span><span class="w">  
        </span><span class="nl">"document.id.strategy.partial.value.projection.type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AllowList"</span><span class="p">,</span><span class="w">  
        </span><span class="nl">"writemodel.strategy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"com.mongodb.kafka.connect.sink.writemodel.strategy.ReplaceOneBusinessKeyStrategy"</span><span class="w">  
    </span><span class="p">}</span><span class="w">  
</span></pre></table></code></div></div></ul><h2 id="참고">참고</h2><ul><li><a href="https://www.confluent.io/ko-kr/blog/kafka-connect-deep-dive-converters-serialization-explained/" target="_blank">참고1 - JSON and schemas</a><li><a href="https://cwiki.apache.org/confluence/display/KAFKA/KIP-301%3A+Schema+Inferencing+for+JsonConverter" target="_blank">참고2 - KIP-301: Schema Inferencing for JsonConverter</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/kafka/'>Kafka</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/kafka/" class="post-tag no-text-decoration" >kafka</a> <a href="/tags/kafka-streams/" class="post-tag no-text-decoration" >kafka-streams</a> <a href="/tags/kafka-connect/" class="post-tag no-text-decoration" >kafka-connect</a> <a href="/tags/json-schema/" class="post-tag no-text-decoration" >json-schema</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=카프카 커넥트(kafka connect), json 스키마 사용하기 - 의사줌치&url=https://a3magic3pocket.github.io/posts/kafka-connect-json-schema/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=카프카 커넥트(kafka connect), json 스키마 사용하기 - 의사줌치&u=https://a3magic3pocket.github.io/posts/kafka-connect-json-schema/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=카프카 커넥트(kafka connect), json 스키마 사용하기 - 의사줌치&url=https://a3magic3pocket.github.io/posts/kafka-connect-json-schema/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/kafka-large-scale-event-processing-architecture-and-performance-comparison/">Kafka를 활용한 대용량 이벤트 처리 구조 설계와 성능 비교</a><li><a href="/posts/experimenting-with-blue-green-deployments/">블루 - 그린 배포 실험</a><li><a href="/posts/spring-kafka-latest-message-pub-sub-config/">Spring Kafka에서 최신 메시지만 소비하는 Pub/Sub 방식 설정</a><li><a href="/posts/solving-concurrency-problems-with-performance-in-mind/">동시성 문제 해결 방안 성능 실험</a><li><a href="/posts/exploring-authentication-options/">인증방식 고민</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/kafka/">kafka</a> <a class="post-tag" href="/tags/kotlin/">kotlin</a> <a class="post-tag" href="/tags/elasticsearch/">elasticsearch</a> <a class="post-tag" href="/tags/elk/">elk</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/summary/">summary</a> <a class="post-tag" href="/tags/git/">git</a> <a class="post-tag" href="/tags/kafka-streams/">kafka-streams</a> <a class="post-tag" href="/tags/nest/">nest</a> <a class="post-tag" href="/tags/react/">react</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/write-kafka-stream-to-mongodb-using-kafka-connect/"><div class="card-body"> <span class="timeago small" > Mar 27, 2024 <i class="unloaded">2024-03-27T23:23:11+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>카프카 커넥트(kafka connect)로 mongoDB에 카프카 스트림 쓰기</h3><div class="text-muted small"><p> 개요 카프카 스트림의 취합된 결과를 외부 스토리지에 저장하고 싶을 때가 있다. 이때 결과가 담긴 토픽 데이터를 카프카 커넥트(kafka connect)를 이용하여 다른 스토리지에 저장한다. 카프카, mongodb, 카프카 커넥트를 도커 컴포즈로 구축한다. 카프카 커넥트 카프카 커넥트는 카프카 스트림 데이터를 다른 스토리지로 옮...</p></div></div></a></div><div class="card"> <a href="/posts/kafka-streams/"><div class="card-body"> <span class="timeago small" > Mar 27, 2024 <i class="unloaded">2024-03-27T20:14:04+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>카프카 스트림이란?(kafka stream)</h3><div class="text-muted small"><p> 스트림이란? 한 방향으로 흐르는 연속된 데이터 흐름[참고1[참고2] 카프카 스트림이란? 카프카 스트림은 스트림을 처리하는 라이브러리이다. 카프카 스트림은 소비자(consumer)에서 동작한다. 예를 들면, ‘블로그 포스트 조회 수’ 같은 이벤트와 같이 실시간으로 갱신되는 데이터를 처리할 수 있다. 카프카 스트림 특징 카프...</p></div></div></a></div><div class="card"> <a href="/posts/kafka-streams-jsonserializer_result/"><div class="card-body"> <span class="timeago small" > Mar 27, 2024 <i class="unloaded">2024-03-27T21:02:48+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>카프카 스트림, JsonSerializer 사용하기</h3><div class="text-muted small"><p> 개요 생산자(procuder)와 카프카 스트림(kafka streams)이 서로 Json으로 메세지를 주고 받도록 한다[참고1]. 커스텀 Serde를 선언하고 카프카 스트림 설정의 value_serde에 등록한다. Serde란? Serde란 Serializer&lt;&gt;와 Deserializer&lt;&gt; 담긴 Wrapper...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/write-kafka-stream-to-mongodb-using-kafka-connect/" class="btn btn-outline-primary" prompt="Older"><p>카프카 커넥트(kafka connect)로 mongoDB에 카프카 스트림 쓰기</p></a> <a href="/posts/kafka-connect-custom-post-processor/" class="btn btn-outline-primary" prompt="Newer"><p>카프카 커넥트(kafka connect), Custom Post Processor 만들기</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/a3magic3pocket">의사줌치</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/kafka/">kafka</a> <a class="post-tag" href="/tags/kotlin/">kotlin</a> <a class="post-tag" href="/tags/elasticsearch/">elasticsearch</a> <a class="post-tag" href="/tags/elk/">elk</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/summary/">summary</a> <a class="post-tag" href="/tags/git/">git</a> <a class="post-tag" href="/tags/kafka-streams/">kafka streams</a> <a class="post-tag" href="/tags/nest/">nest</a> <a class="post-tag" href="/tags/react/">react</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://a3magic3pocket.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
